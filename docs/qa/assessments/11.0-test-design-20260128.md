# Test Design: Story 11.0 - Responsive Mobile-Friendly UI

Date: 2026-01-28 (v2 - updated for AC renumbering)
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 37
- Unit tests: 8 (22%)
- Integration tests: 12 (32%)
- E2E tests: 17 (46%)
- Priority distribution: P0: 12, P1: 14, P2: 9, P3: 2

### Rationale

This story is predominantly UI/layout work, which shifts the balance toward integration and E2E tests. Unit tests cover breakpoint logic and property calculations. Integration tests verify component-level responsive behavior. E2E tests validate cross-device user journeys, visual regressions, and performance thresholds.

### v2 Changes

- Added AC10 (tab-switch state preservation) as distinct section with E2E-015/016
- Renumbered AC10 (performance) → AC11 with measurable thresholds
- Added E2E-017 for format operation <500ms per AC11
- Updated E2E-012 threshold from 5s to 500ms for format operation
- Added E2E-018 for layout transition <200ms measurement

## Test Scenarios by Acceptance Criteria

### AC1: Application usable on screens as small as 320px width

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 11.0-UNIT-001 | Unit | P0 | Verify `minimumWidth` property is 320 | Pure property check |
| 11.0-UNIT-002 | Unit | P0 | Verify `minimumHeight` property is 480 | Pure property check |
| 11.0-E2E-001 | E2E | P0 | Load app at 320px width, verify no content overflow or horizontal scroll | Critical minimum viewport |
| 11.0-E2E-002 | E2E | P1 | At 320px, paste JSON, format, copy result - full workflow | Minimum-width user journey |

### AC2: Desktop experience unchanged for screens >= 1024px

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 11.0-INT-001 | Integration | P0 | Visual regression screenshot at 1024px matches pre-change baseline | Multi-component layout verification |
| 11.0-INT-002 | Integration | P0 | Visual regression screenshot at 1280px matches baseline | Common desktop width |
| 11.0-INT-003 | Integration | P1 | Visual regression screenshot at 1920px matches baseline | Wide desktop |
| 11.0-E2E-003 | E2E | P0 | Full desktop workflow at 1024px: load file, format, minify, copy, switch theme | Regression critical path |

### AC3: Toolbar adapts to screen width (3 breakpoints)

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 11.0-UNIT-003 | Unit | P1 | `isDesktop` true at 1024, false at 1023 | Breakpoint boundary logic |
| 11.0-UNIT-004 | Unit | P1 | `isTablet` true at 768, false at 767, false at 1024 | Breakpoint boundary logic |
| 11.0-UNIT-005 | Unit | P1 | `isMobile` true at 767, false at 768 | Breakpoint boundary logic |
| 11.0-INT-004 | Integration | P1 | At >= 1024px: all toolbar buttons visible, no overflow menu | Component layout verification |
| 11.0-INT-005 | Integration | P1 | At 768-1023px: icon-only buttons, key actions visible | Compact toolbar |
| 11.0-INT-006 | Integration | P1 | At < 768px: overflow menu button visible, only Format button on toolbar | Mobile toolbar |
| 11.0-E2E-004 | E2E | P1 | Open overflow menu on mobile, access Minify, indent options, view toggle | Mobile menu journey |

### AC4: Header adapts to screen width

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 11.0-INT-007 | Integration | P1 | At >= 768px: full header with all badges and title visible | Header layout check |
| 11.0-INT-008 | Integration | P1 | At < 768px: compact header, "Airgap Protected" badge visible, "Offline Ready" hidden | Mobile header |
| 11.0-E2E-005 | E2E | P2 | On mobile, access theme toggle via hamburger/overflow menu | Mobile navigation path |

### AC5: SplitView adapts (split vs tab-based)

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 11.0-INT-009 | Integration | P0 | At >= 768px: SplitView visible with two panes | Core layout mode |
| 11.0-INT-010 | Integration | P0 | At < 768px: Tab-based toggle with "Input" and "Output" tabs | Core mobile layout |
| 11.0-E2E-006 | E2E | P0 | On mobile, switch between Input/Output tabs, verify content preserved | State preservation critical path |
| 11.0-E2E-007 | E2E | P1 | On tablet (768-1023px), split panes with reduced minimum sizes (200px) | Tablet usability |

### AC6: Touch targets minimum 44x44px on mobile

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 11.0-UNIT-006 | Unit | P1 | `touchTargetSize` property equals 44 | Property constant check |
| 11.0-INT-011 | Integration | P1 | At < 768px, all interactive elements have >= 44x44 bounding box | Accessibility/usability |
| 11.0-E2E-008 | E2E | P2 | Tap all toolbar buttons on real touch device without mis-tap | Real device touch validation |

### AC7: Text remains readable (minimum 14px on mobile)

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 11.0-UNIT-007 | Unit | P2 | `mobileFontSize` property equals 14 | Property constant check |
| 11.0-INT-012 | Integration | P2 | At < 768px, body text, editor text, button text all >= 14px | Layout font verification |

### AC8: Keyboard shortcuts still work on desktop

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 11.0-E2E-009 | E2E | P0 | At 1024px+, Ctrl+Shift+F formats JSON | Regression - desktop shortcuts |
| 11.0-E2E-010 | E2E | P1 | At 1024px+, all documented shortcuts work (Ctrl+L load, Ctrl+M minify, etc.) | Full shortcut regression |

### AC9: All existing functionality preserved

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 11.0-E2E-011 | E2E | P0 | Full feature smoke test at 1024px: format, minify, copy, load, clear, indent change, theme toggle, history | Comprehensive regression |

### AC10: Mobile input/output tab switch preserves state

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 11.0-E2E-015 | E2E | P0 | Switch Input→Output→Input: text content identical | State preservation - content |
| 11.0-E2E-016 | E2E | P0 | Switch Input→Output→Input: cursor position, scroll position preserved | State preservation - position |
| 11.0-E2E-006 | E2E | P0 | (Shared with AC5) Full tab-switch state validation including undo history | Cross-AC critical path |

**Given-When-Then:**
- **Given** mobile layout (<768px) with JSON in input pane and cursor at line 5
- **When** user switches to Output tab then back to Input tab
- **Then** text content unchanged, cursor at line 5, scroll position maintained, undo history preserved (Ctrl+Z works)

### AC11: Performance thresholds on mid-range mobile

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 11.0-UNIT-008 | Unit | P2 | Breakpoint properties use `readonly` keyword (no re-evaluation) | Performance guardrail |
| 11.0-E2E-012 | E2E | P2 | FCP on throttled mobile (4x CPU, Fast 3G) < 3s | AC11 FCP threshold |
| 11.0-E2E-013 | E2E | P2 | TTI on throttled mobile (4x CPU, Fast 3G) < 5s | AC11 TTI threshold |
| 11.0-E2E-017 | E2E | P1 | Format 10KB JSON on throttled CPU (4x) completes in < 500ms | AC11 format operation threshold |
| 11.0-E2E-018 | E2E | P2 | Resize window 1920px→320px: layout settles in < 200ms, no flicker | AC11 layout transition threshold |
| 11.0-E2E-014 | E2E | P3 | Full page load including WASM on Fast 3G < 10s | Extended load scenario |

**Threshold Summary (per AC11):**
| Metric | Threshold | Test ID |
|--------|-----------|---------|
| FCP | < 3s | E2E-012 |
| TTI | < 5s | E2E-013 |
| Format 10KB | < 500ms | E2E-017 |
| Layout transition | < 200ms | E2E-018 |

## Risk Coverage

| Risk ID | Risk Description | Test IDs | Coverage |
|---------|------------------|----------|----------|
| TECH-001 | Desktop layout regression | INT-001, INT-002, INT-003, E2E-003, E2E-011 | Full |
| TECH-002 | Qt WASM touch handling | E2E-008, E2E-004 | Partial (needs real device) |
| PERF-001 | Mobile performance degradation | E2E-012, E2E-013, E2E-014, E2E-017, E2E-018 | Full |
| TECH-004 | State loss on tab switch | E2E-006, E2E-015, E2E-016 | Full |
| BUS-001 | Mobile UX insufficient | E2E-002, E2E-004, E2E-005 | Moderate |
| OPS-001 | Inadequate cross-device coverage | E2E-008 + device matrix | Requires device matrix |
| TECH-003 | Layout thrashing | E2E-018 | Direct |
| TECH-005 | Breakpoint boundary artifacts | UNIT-003, UNIT-004, UNIT-005 | Direct |

## Test Data Requirements

| Data | Purpose | Details |
|------|---------|---------|
| Small JSON (100B) | Basic functionality | `{"key": "value"}` |
| Medium JSON (10KB) | Performance validation (AC11) | Nested object with arrays, used for E2E-017 |
| Large JSON (1MB) | Stress test on mobile | Auto-generated nested structure |
| Invalid JSON | Error handling on mobile | Truncated/malformed samples |
| JSON with sensitive data | Verify airgap on all layouts | Contains fake API keys, PII |

### Sample 10KB Test JSON Generator

```javascript
// Generate 10KB nested JSON for E2E-017
function generate10KBJson() {
  const items = [];
  for (let i = 0; i < 100; i++) {
    items.push({
      id: i,
      name: `Item ${i}`,
      description: `Description for item ${i} with additional text to increase size`,
      metadata: {
        created: "2026-01-28T00:00:00Z",
        tags: ["tag1", "tag2", "tag3"],
        nested: { level1: { level2: { level3: { value: i } } } }
      }
    });
  }
  return JSON.stringify({ data: items }, null, 2);
}
```

## Environment Requirements

| Environment | Purpose | Required For |
|-------------|---------|-------------|
| Chrome DevTools device mode | Viewport simulation | INT and E2E viewport tests |
| Real iPhone (Safari) | Touch + iOS rendering | E2E-008, TECH-002 risk |
| Real Android (Chrome) | Touch + Android rendering | E2E-008, TECH-002 risk |
| iPad or tablet emulator | Tablet layout | E2E-007 |
| CPU throttling (4x) | Mobile perf simulation | E2E-012, E2E-013, E2E-017 |
| Network throttling (Fast 3G) | Mobile load testing | E2E-012, E2E-013 |
| Screenshot comparison tool | Visual regression | INT-001, INT-002, INT-003 |
| Performance profiler | Layout transition timing | E2E-018 |

### Device Testing Matrix

| Device | Width | Priority | Tests |
|--------|-------|----------|-------|
| iPhone SE | 375px | High | E2E-001, E2E-002, E2E-008 |
| iPhone 14 | 390px | High | E2E-004, E2E-006 |
| iPad Mini (portrait) | 744px | Medium | E2E-007 |
| iPad Mini (landscape) | 1024px | Medium | E2E-003 |
| Desktop Chrome | 1280px | High | INT-002, E2E-011 |
| Desktop Firefox | 1920px | Medium | INT-003 |

## Recommended Execution Order

1. **P0 Unit tests** (UNIT-001, 002) - fail fast on config
2. **P0 Integration tests** (INT-001, 002, 009, 010) - layout correctness
3. **P0 E2E tests** (E2E-001, 003, 006, 009, 011, 015, 016) - critical journeys + state preservation
4. **P1 Unit + Integration tests** - breakpoints and component behavior
5. **P1 E2E tests** (E2E-017 especially) - format performance is P1
6. **P2+ tests** as time permits
7. **Real device testing** last (highest setup cost)

## Gate YAML Block

```yaml
test_design:
  version: 2
  date: '2026-01-28'
  scenarios_total: 37
  by_level:
    unit: 8
    integration: 12
    e2e: 17
  by_priority:
    p0: 12
    p1: 14
    p2: 9
    p3: 2
  coverage_gaps:
    - "AC6 touch target validation requires real device - cannot be fully automated"
    - "TECH-002 (Qt WASM touch) only partially testable without real devices"
  resolved_since_v1:
    - "AC10 (tab-switch state) now has dedicated E2E-015/016 tests"
    - "AC11 performance thresholds now measurable with E2E-012/013/017/018"
    - "E2E-017 added for format <500ms threshold (was missing)"
```

## Traceability Summary

| AC | Requirement Summary | Primary Tests | Coverage |
|----|---------------------|---------------|----------|
| AC1 | Usable at 320px | UNIT-001/002, E2E-001/002 | Full |
| AC2 | Desktop unchanged ≥1024px | INT-001/002/003, E2E-003 | Full |
| AC3 | Toolbar adapts (3 breakpoints) | UNIT-003/004/005, INT-004/005/006, E2E-004 | Full |
| AC4 | Header adapts | INT-007/008, E2E-005 | Full |
| AC5 | SplitView adapts | INT-009/010, E2E-006/007 | Full |
| AC6 | Touch targets ≥44px | UNIT-006, INT-011, E2E-008 | Partial (device) |
| AC7 | Text ≥14px mobile | UNIT-007, INT-012 | Full |
| AC8 | Keyboard shortcuts | E2E-009/010 | Full |
| AC9 | All functionality preserved | E2E-011 | Full |
| AC10 | Tab-switch state preservation | E2E-006, E2E-015/016 | Full |
| AC11 | Performance thresholds | UNIT-008, E2E-012/013/017/018 | Full |
