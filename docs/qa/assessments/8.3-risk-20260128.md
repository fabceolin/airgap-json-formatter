# Risk Profile: Story 8.3 - Bridge Layer XML Methods

Date: 2026-01-28
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 5
- Critical Risks: 0
- High Risks: 0
- Medium Risks: 2
- Low Risks: 3
- Risk Score: 84/100 (Low Risk)

## Risk Matrix

| Risk ID   | Description                                    | Probability | Impact     | Score | Priority |
|-----------|------------------------------------------------|-------------|------------|-------|----------|
| TECH-001  | AsyncSerialiser integration inconsistency      | Medium (2)  | Medium (2) | 4     | Medium   |
| TECH-002  | Native/WASM parity differences                 | Medium (2)  | Medium (2) | 4     | Medium   |
| OPS-001   | Regression impact on existing JSON methods     | Low (1)     | Medium (2) | 2     | Low      |
| TECH-003  | Signal connection timing issues                | Low (1)     | Low (1)    | 1     | Minimal  |
| DATA-001  | Large XML input handling                       | Low (1)     | Low (1)    | 1     | Minimal  |

## Detailed Risk Analysis

### TECH-001: AsyncSerialiser Integration Inconsistency

**Score: 4 (Medium)**

**Probability**: Medium - The existing JSON methods follow a well-documented pattern, but copy-paste errors or subtle variations in implementation could cause issues. The AsyncSerialiser has specific requirements (FIFO, single-flight, watchdog timeout).

**Impact**: Medium - Incorrect integration could lead to queue lockups, out-of-order signal emissions, or watchdog timeouts, degrading user experience.

**Affected Components**:
- `qt/jsonbridge.cpp` (new XML method implementations)
- `qt/asyncserialiser.h` (existing queue system)

**Mitigation**:
- Follow `formatJson()` implementation exactly as documented in story Dev Notes
- Use QMetaObject::invokeMethod for signal emission on main thread
- Ensure QPromise start/finish calls are balanced
- Add unit tests that verify queue behavior with mixed JSON/XML operations

**Residual Risk**: Low - Pattern is well-established and documented

---

### TECH-002: Native/WASM Parity Differences

**Score: 4 (Medium)**

**Probability**: Medium - The bridge layer must work for both native Qt builds and WASM builds. Native builds use Qt's QJsonDocument while WASM calls through to Rust. XML handling may expose behavioral differences.

**Impact**: Medium - Users switching between native desktop and web versions could see different behavior or errors.

**Affected Components**:
- `qt/jsonbridge.cpp` (#ifdef __EMSCRIPTEN__ blocks)
- `public/bridge.js` (WASM wrapper functions)
- `src/xml_formatter.rs`, `src/xml_highlighter.rs` (Rust implementations)

**Mitigation**:
- **For native builds**: Implement equivalent Qt-based XML formatting/highlighting (story may need to address this gap)
- Test both build targets explicitly
- Document any expected differences in native vs WASM behavior
- Consider whether native XML support is in-scope or deferred

**Residual Risk**: Medium - Native XML support may require additional implementation not detailed in story

---

### OPS-001: Regression Impact on Existing JSON Methods

**Score: 2 (Low)**

**Probability**: Low - Adding new methods shouldn't affect existing ones, but shared infrastructure (AsyncSerialiser, JsonBridge class) could have unintended side effects.

**Impact**: Medium - Breaking JSON functionality would impact existing users severely.

**Affected Components**:
- `qt/jsonbridge.h` (header modifications)
- `qt/jsonbridge.cpp` (method additions)

**Mitigation**:
- Run full JSON test suite after changes (AC: 6)
- Verify `formatJson`, `minifyJson`, `highlightJson` still work via regression tests
- Keep XML methods structurally isolated from JSON code paths

**Residual Risk**: Minimal - Changes are additive, not modifying existing implementations

---

### TECH-003: Signal Connection Timing Issues

**Score: 1 (Minimal)**

**Probability**: Low - Qt signal/slot mechanism is well-understood, but new signals must be connected correctly in QML consumers.

**Impact**: Low - Missing signal connections would result in silent failures or uncaught results.

**Affected Components**:
- `qt/jsonbridge.h` (new signals: `formatXmlCompleted`, `minifyXmlCompleted`)
- QML files consuming the signals

**Mitigation**:
- Follow existing signal pattern from JSON methods
- Add test cases that verify signals are emitted with correct result structure
- Document signal format in story Dev Notes (already present)

**Residual Risk**: Minimal

---

### DATA-001: Large XML Input Handling

**Score: 1 (Minimal)**

**Probability**: Low - Users may paste very large XML documents, but this is an edge case.

**Impact**: Low - Large inputs could cause slow rendering or memory pressure, but Rust's XML parser handles this reasonably.

**Affected Components**:
- `src/xml_formatter.rs` (Rust formatter)
- `qt/jsonbridge.cpp` (QString memory handling)

**Mitigation**:
- Rust formatter already handles edge cases (tested in Story 8.1)
- AsyncSerialiser has 30-second watchdog timeout for hung operations
- Consider adding size limits if performance becomes an issue (future enhancement)

**Residual Risk**: Minimal - Existing timeout mechanisms provide protection

---

## Risk Distribution

### By Category
- Technical: 3 risks (0 critical, 2 medium)
- Security: 0 risks
- Performance: 0 risks (covered by DATA-001 edge case)
- Data: 1 risk (0 critical)
- Business: 0 risks
- Operational: 1 risk (0 critical)

### By Component
- Qt/C++ Layer: 4 risks
- Rust/WASM Layer: 1 risk
- Bridge/JS Layer: 1 risk

## Risk-Based Testing Strategy

### Priority 1: Critical Risk Tests
- None identified (no critical risks)

### Priority 2: Medium Risk Tests
- **TECH-001 Tests**:
  - Enqueue multiple formatXml/minifyXml operations, verify FIFO order
  - Mix XML and JSON operations in same queue, verify no interference
  - Force watchdog timeout scenario, verify recovery
- **TECH-002 Tests**:
  - Test native build: formatXml, minifyXml, highlightXml functionality
  - Test WASM build: same operations via browser
  - Compare output parity where applicable

### Priority 3: Standard Tests
- Signal emission tests for success/error paths
- Regression tests for all JSON methods (formatJson, minifyJson, highlightJson, validateJson)
- Basic XML formatting with various indent types
- Error handling for malformed XML input

## Risk Acceptance Criteria

### Must Fix Before Production
- None (no critical risks)

### Can Deploy with Mitigation
- TECH-001: Ensure thorough code review following existing patterns
- TECH-002: Document if native XML is deferred; test WASM path thoroughly

### Accepted Risks
- DATA-001: Accepted - existing timeout mechanism provides adequate protection

## Monitoring Requirements

Post-deployment monitoring for:
- Error rates on formatXml/minifyXml operations
- Queue length warnings from AsyncSerialiser
- Task timeout occurrences

## Risk Review Triggers

Review and update risk profile when:
- Native XML support is implemented (TECH-002)
- Performance issues reported with large XML files
- AsyncSerialiser behavior changes

---

## Gate YAML Block

```yaml
# risk_summary (paste into gate file):
risk_summary:
  totals:
    critical: 0
    high: 0
    medium: 2
    low: 3
  highest:
    id: TECH-001
    score: 4
    title: "AsyncSerialiser integration inconsistency"
  recommendations:
    must_fix: []
    monitor:
      - "Queue length and timeout metrics for XML operations"
      - "Native vs WASM behavior parity during testing"
```

---

Risk profile: docs/qa/assessments/8.3-risk-20260128.md
