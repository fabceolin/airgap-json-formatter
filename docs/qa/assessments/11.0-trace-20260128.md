# Requirements Traceability Matrix

## Story: 11.0 - Responsive Mobile-Friendly UI

**Trace Date:** 2026-01-28 (v3 - updated for v1.3/v1.4 story corrections)
**Traced By:** Quinn (Test Architect)
**Story Version:** 1.5

---

## Coverage Summary

- **Total Requirements Traced:** 11 (AC1–AC11)
- **Fully Covered:** 7 (64%)
- **Partially Covered:** 4 (36%)
- **Not Covered:** 0 (0%)

| Coverage Level | Count | Percentage |
|----------------|-------|------------|
| Full | 7 | 64% |
| Partial | 4 | 36% |
| None | 0 | 0% |

---

## Requirement Mappings

### AC1: Application usable on screens as small as 320px width

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `UNIT-001` - minimumWidth property check
  - Given: Main.qml loaded
  - When: Reading minimumWidth property
  - Then: Value equals 320

- **Unit Test**: `UNIT-002` - minimumHeight property check
  - Given: Main.qml loaded
  - When: Reading minimumHeight property
  - Then: Value equals 480

- **E2E Test**: `E2E-001` - Minimum viewport usability
  - Given: Application loaded at 320px width
  - When: User views the interface
  - Then: No horizontal scroll, no content overflow, all elements accessible

- **E2E Test**: `E2E-002` - Full workflow at minimum width
  - Given: Application at 320px width
  - When: User pastes JSON, formats, copies result
  - Then: All operations complete successfully

---

### AC2: Desktop experience unchanged for screens >= 1024px

**Coverage: FULL**

Given-When-Then Mappings:

- **Integration Test**: `INT-001` - Visual regression at 1024px
  - Given: Application at 1024px width
  - When: Screenshot captured
  - Then: Pixel-match with pre-change baseline (< 1% diff)

- **Integration Test**: `INT-002` - Visual regression at 1280px
  - Given: Application at 1280px width
  - When: Screenshot captured
  - Then: Pixel-match with baseline (< 1% diff)

- **Integration Test**: `INT-003` - Visual regression at 1920px
  - Given: Application at 1920px width
  - When: Screenshot captured
  - Then: Pixel-match with baseline (< 1% diff)

- **E2E Test**: `E2E-003` - Desktop workflow regression
  - Given: Application at 1024px width
  - When: User executes load file, format, minify, copy, switch theme
  - Then: All operations work as before changes

- **E2E Test**: `E2E-011` - Full feature smoke test
  - Given: Application at 1024px width
  - When: User exercises format, minify, copy, load, clear, indent, theme, history
  - Then: All features work correctly

---

### AC3: Toolbar adapts to screen width (3 breakpoints)

**Coverage: PARTIAL**

Given-When-Then Mappings:

- **Unit Test**: `UNIT-003` - isDesktop breakpoint logic
  - Given: Window width at 1024px or 1023px
  - When: Checking isDesktop property
  - Then: True at 1024, false at 1023

- **Unit Test**: `UNIT-004` - isTablet breakpoint logic
  - Given: Window width at 767/768/1024px
  - When: Checking isTablet property
  - Then: True at 768-1023, false otherwise

- **Unit Test**: `UNIT-005` - isMobile breakpoint logic
  - Given: Window width at 767/768px
  - When: Checking isMobile property
  - Then: True at 767, false at 768

- **Integration Test**: `INT-004` - Full toolbar at desktop
  - Given: Application at >= 1024px
  - When: Toolbar renders
  - Then: All buttons visible, no overflow menu

- **Integration Test**: `INT-005` - Compact toolbar at tablet
  - Given: Application at 768-1023px
  - When: Toolbar renders
  - Then: Icon-only buttons, key actions visible

- **Integration Test**: `INT-006` - Mobile toolbar
  - Given: Application at < 768px
  - When: Toolbar renders
  - Then: Only Format button + overflow menu icon visible

- **E2E Test**: `E2E-004` - Mobile overflow menu journey
  - Given: Application at mobile width
  - When: User taps overflow menu
  - Then: Menu opens with Minify, indent, view toggle, theme options

**Gap:** No automated visual verification of icon-only mode at 768-1023px (GAP-005). INT-005 checks component properties but not rendered appearance. Consider follow-up story for CI visual regression.

---

### AC4: Header adapts to screen width

**Coverage: PARTIAL**

Given-When-Then Mappings:

- **Integration Test**: `INT-007` - Full header at tablet+
  - Given: Application at >= 768px
  - When: Header renders
  - Then: Full header with all badges and title visible

- **Integration Test**: `INT-008` - Compact header on mobile
  - Given: Application at < 768px
  - When: Header renders
  - Then: Compact header, "Airgap Protected" visible, "Offline Ready" hidden

- **E2E Test**: `E2E-005` - Mobile theme access
  - Given: Application at mobile width
  - When: User opens overflow/hamburger menu
  - Then: Theme toggle accessible

- **E2E Test**: `E2E-019` - Airgap badge visibility during workflow (GAP-002 resolution)
  - Given: Application at 375px width
  - When: User performs format workflow
  - Then: "Airgap Protected" badge remains visible throughout

**Gap resolved:** GAP-002 addressed by E2E-019 which validates badge visibility at mobile width during actual workflow.

---

### AC5: SplitView adapts (split vs tab-based)

**Coverage: FULL**

Given-When-Then Mappings:

- **Integration Test**: `INT-009` - Split view at tablet+
  - Given: Application at >= 768px
  - When: Content area renders
  - Then: SplitView visible with two panes

- **Integration Test**: `INT-010` - Tab view on mobile
  - Given: Application at < 768px
  - When: Content area renders
  - Then: Tab-based toggle with "Input" and "Output" tabs

- **E2E Test**: `E2E-006` - Tab switch state preservation
  - Given: Mobile layout with JSON in input pane
  - When: User switches Input -> Output -> Input
  - Then: Content, cursor, scroll, undo history preserved

- **E2E Test**: `E2E-007` - Tablet split pane usability
  - Given: Application at 768-1023px
  - When: Split view renders
  - Then: Panes with reduced minimum sizes (200px), touch-friendly handle

---

### AC6: Touch targets minimum 44x44px on mobile

**Coverage: PARTIAL**

Given-When-Then Mappings:

- **Unit Test**: `UNIT-006` - Touch target constant
  - Given: Theme.qml loaded
  - When: Reading touchTargetSize property
  - Then: Value equals 44

- **Integration Test**: `INT-011` - Touch target size validation
  - Given: Application at < 768px
  - When: Measuring interactive element bounding boxes
  - Then: All >= 44x44px

- **Integration Test**: `INT-013` - Computed size validation (GAP-004 resolution)
  - Given: Application at mobile width
  - When: Measuring computed element sizes via DOM API
  - Then: All interactive elements >= 44x44px actual rendered size

- **E2E Test**: `E2E-008` - Real device touch validation
  - Given: Real touch device (iPhone/Android)
  - When: User taps all toolbar buttons
  - Then: No mis-taps, all targets reachable

**Gap partially resolved:** GAP-004 addressed by INT-013 (computed size validation) and Task 11 real-device testing requirements. Full resolution requires manual device testing execution.

---

### AC7: Text remains readable (minimum 14px on mobile)

**Coverage: PARTIAL**

Given-When-Then Mappings:

- **Unit Test**: `UNIT-007` - Mobile font size constant
  - Given: Theme.qml loaded
  - When: Reading mobileFontSize property
  - Then: Value equals 14

- **Integration Test**: `INT-012` - Font size validation
  - Given: Application at < 768px
  - When: Measuring text elements
  - Then: Body text, editor text, button text all >= 14px

**Gap:** Property check only; no rendered-size validation in browser to confirm CSS/QML actually produces 14px+ text. Low severity as Qt rendering is deterministic.

---

### AC8: Keyboard shortcuts still work on desktop

**Coverage: FULL**

Given-When-Then Mappings:

- **E2E Test**: `E2E-009` - Primary shortcut regression
  - Given: Application at 1024px+ width
  - When: User presses Ctrl+Shift+F
  - Then: JSON formats correctly

- **E2E Test**: `E2E-010` - Full shortcut regression
  - Given: Application at 1024px+ width
  - When: User tests all documented shortcuts (Ctrl+L, Ctrl+M, etc.)
  - Then: All shortcuts work as documented

---

### AC9: All existing functionality preserved

**Coverage: FULL**

Given-When-Then Mappings:

- **E2E Test**: `E2E-011` - Comprehensive desktop smoke test
  - Given: Application at 1024px width
  - When: User exercises all features (format, minify, copy, load, clear, indent, theme, history)
  - Then: All features work correctly

- **E2E Test**: `E2E-020` - Mobile smoke test (GAP-003 resolution)
  - Given: Application at 375px width
  - When: User exercises all features via overflow menu (format, minify, copy, load, clear, theme, tree expand/collapse)
  - Then: All features accessible and functional on mobile

**Gap resolved:** GAP-003 addressed by E2E-020 (Task 12) which provides mobile-width feature regression testing.

---

### AC10: Mobile input/output tab switch preserves state

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `UNIT-009` - Tab selection initializes to "input"
  - Given: InputOutputToggle.qml loaded
  - When: Component initializes
  - Then: activePane === "input"

- **Unit Test**: `UNIT-010` - Tab selection state transition
  - Given: InputOutputToggle.qml with activePane "input"
  - When: Clicking "Output" tab
  - Then: activePane === "output"

- **Unit Test**: `UNIT-011` - Both panes kept alive
  - Given: InputOutputToggle.qml loaded
  - When: Checking loader active states
  - Then: Both inputLoader.active and outputLoader.active === true (never destroyed)

- **Unit Test**: `UNIT-012` - Tab change signal emission
  - Given: InputOutputToggle.qml loaded
  - When: Tab changes
  - Then: tabChanged signal emits with previous/current state

- **E2E Test**: `E2E-006` - State preservation (cross-AC)
  - Given: Mobile layout (<768px) with JSON in input pane, cursor at line 5
  - When: User switches to Output tab then back to Input tab
  - Then: Text content unchanged, cursor at line 5, scroll position maintained, undo history preserved

- **E2E Test**: `E2E-015` - Content preservation
  - Given: Mobile layout with text in input pane
  - When: User switches Input -> Output -> Input
  - Then: Text content identical

- **E2E Test**: `E2E-016` - Position preservation
  - Given: Mobile layout with cursor and scroll position set
  - When: User switches Input -> Output -> Input
  - Then: Cursor position and scroll position preserved

---

### AC11: Performance thresholds on mid-range mobile

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `UNIT-008` - Readonly breakpoint properties
  - Given: Theme.qml loaded
  - When: Checking breakpoint property declarations
  - Then: All use `readonly` keyword (no re-evaluation)

- **E2E Test**: `E2E-012` - FCP threshold
  - Given: Mid-range mobile (4x CPU throttle, Fast 3G)
  - When: Page loads
  - Then: First Contentful Paint < 3s

- **E2E Test**: `E2E-013` - TTI threshold
  - Given: Mid-range mobile (4x CPU throttle, Fast 3G)
  - When: Page loads
  - Then: Time to Interactive < 5s

- **E2E Test**: `E2E-017` - Format operation threshold (500ms)
  - Given: Mid-range mobile (4x CPU throttle), 10KB JSON payload
  - When: User triggers format operation
  - Then: Operation completes < 500ms

- **E2E Test**: `E2E-018` - Layout transition threshold
  - Given: Application at 1920px
  - When: Window resizes to 320px
  - Then: Layout settles < 200ms, no visible flickering

---

## PRD Alignment Analysis

| PRD Requirement | Story Alignment | Status |
|-----------------|----------------|--------|
| NFR7: Responsive 1024px–4K | Story extends to 320px | **SCOPE EXPANSION** — PRD amended 2026-01-28 |
| Section 3.6: "Not optimized for mobile phones" | Story explicitly targets mobile phones (375px) | **PRD AMENDED** — Section 3.6 updated |
| NFR1: Zero network after load | Preserved — no new network calls | **ALIGNED** |
| NFR6: Modern browser support | Story adds mobile Safari/Chrome requirements | **EXTENDS** — compatible expansion |
| NFR8: No persistent storage | No change | **ALIGNED** |

**PRD Contradiction Resolution:** Story v1.5 documents that PRD Section 3.6 and NFR7 were amended 2026-01-28 to support 320px+ mobile target. Blocking dependency removed.

---

## Gap Analysis

### Resolved Gaps (v3)

| Gap ID | Description | Resolution | Status |
|--------|-------------|------------|--------|
| GAP-001 | Performance baselines undefined | AC11 defines FCP <3s, TTI <5s, format <500ms, layout <200ms | ✅ RESOLVED |
| GAP-002 | Airgap badge visibility on mobile | E2E-019 validates at 375px during workflow | ✅ RESOLVED |
| GAP-003 | Mobile feature regression | Task 12 + E2E-020 mobile smoke at 375px | ✅ RESOLVED |
| GAP-006 | PRD Section 3.6 contradiction | Captured as dependency; PRD amended v1.5 | ✅ RESOLVED |
| GAP-007 | Orientation change behavior | E2E-021 tests orientation change (Task 11) | ✅ ADDRESSED |
| GAP-008 | Tab-switch state preservation | AC10 explicit requirement | ✅ RESOLVED |
| GAP-009 | Test design AC numbering mismatch | Test design v3 updated | ✅ RESOLVED |
| GAP-010 | Format 500ms threshold test | E2E-017 specifically tests this | ✅ RESOLVED |

### Partially Resolved Gaps

| Gap ID | Description | Status | Notes |
|--------|-------------|--------|-------|
| GAP-004 | Touch target validation requires real device | ⚠️ PARTIAL | INT-013 added; Task 11 includes device testing but requires execution |

### Open Gaps (Low Severity)

| Gap ID | Description | Severity | Action |
|--------|-------------|----------|--------|
| GAP-005 | Tablet toolbar visual regression (768-1023px) | Low | Follow-up story for CI visual regression |

---

## Critical Gaps

None remaining. All high/medium severity gaps resolved in v1.3/v1.4 story corrections.

---

## Test Design Recommendations

Based on trace analysis:

### Test Data Requirements

- **Small JSON** (100B): Basic functionality
- **Medium JSON** (10KB): Performance validation (AC11 format threshold)
- **Large JSON** (1MB): Mobile stress test
- **Invalid JSON**: Error handling on all viewports
- **Sensitive JSON**: Verify airgap across all layouts

### Mock/Stub Strategies

- Use Chrome DevTools device mode for viewport simulation
- Use CPU/network throttling for performance thresholds (4x CPU, Fast 3G)
- Real devices required for touch validation (no mock available)

---

## Risk Assessment

| Risk Level | Requirements |
|------------|--------------|
| **Low Risk** | AC1, AC2, AC5, AC8, AC9, AC10, AC11 (full coverage) |
| **Medium Risk** | AC3, AC4, AC6, AC7 (partial coverage - visual/device gaps) |
| **High Risk** | None |

---

## Gate YAML Block

```yaml
trace:
  totals:
    requirements: 11
    full: 7
    partial: 4
    none: 0
  planning_ref: 'docs/qa/assessments/11.0-test-design-v3-20260128.md'
  uncovered: []
  notes: 'v3 trace reflects v1.3/v1.4 story corrections. All high/medium gaps resolved. PRD Section 3.6 captured as blocking dependency and subsequently amended.'
```

---

## Trace Matrix Summary

| AC | Requirement | Test Count | Coverage | Change from v2 |
|----|-------------|------------|----------|----------------|
| AC1 | Usable at 320px width | 4 | Full | — |
| AC2 | Desktop unchanged ≥1024px | 5 | Full | — |
| AC3 | Toolbar adapts (3 breakpoints) | 7 | Partial | — |
| AC4 | Header adapts | 4 | Partial | +1 (E2E-019) |
| AC5 | SplitView adapts | 4 | Full | — |
| AC6 | Touch targets ≥44px | 4 | Partial | +1 (INT-013) |
| AC7 | Text ≥14px mobile | 2 | Partial | — |
| AC8 | Keyboard shortcuts | 2 | Full | — |
| AC9 | All functionality preserved | 2 | Full | +1 (E2E-020) |
| AC10 | Tab-switch state preservation | 7 | Full | +4 (UNIT-009–012) |
| AC11 | Performance thresholds | 5 | Full | +1 (E2E-017) |

---

## Version History

| Version | Date | Changes |
|---------|------|---------|
| v1 | 2026-01-28 | Initial trace against story v1.1 |
| v2 | 2026-01-28 | Updated for story v1.2 corrections; AC10/AC11 renumbering |
| v3 | 2026-01-28 | Updated for story v1.3/v1.4/v1.5 corrections; unit tests for new components; resolved gaps GAP-002/003/007/010 |

---

## Conclusion

**Overall Trace Status: PASS**

The requirements trace shows 64% full coverage (7 of 11 ACs), with 4 ACs at partial coverage due to:
- Visual verification limitations (AC3, AC4) — low severity
- Real-device testing requirements (AC6) — partial mitigation via INT-013
- Rendered font size validation (AC7) — low severity, Qt is deterministic

All high and medium severity gaps have been resolved through story v1.3/v1.4/v1.5 corrections:
- PRD contradiction captured and subsequently amended
- Unit tests added for new QML components (InputOutputToggle, OverflowMenu)
- Mobile smoke test added (E2E-020)
- Airgap badge visibility test added (E2E-019)
- Format operation threshold test added (E2E-017)
- Orientation change test added (E2E-021)
- Touch fallback implementation specified (Task 8)

**Recommendation:** Story is ready for development. Remaining partial coverage gaps (visual regression, real-device touch) are low severity and addressable during test execution.

---

*Trace matrix: docs/qa/assessments/11.0-trace-20260128.md*
