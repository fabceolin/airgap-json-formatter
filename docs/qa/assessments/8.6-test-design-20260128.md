# Test Design: Story 8.6 - XML Tree Model

Date: 2026-01-28
Designer: Quinn (Test Architect)

## Test Strategy Overview

- **Total test scenarios:** 32
- **Unit tests:** 18 (56%)
- **Integration tests:** 10 (31%)
- **E2E tests:** 4 (13%)
- **Priority distribution:** P0: 8, P1: 14, P2: 8, P3: 2

## Test Scenarios by Acceptance Criteria

### AC1: QXmlTreeModel class created following QJsonTreeModel pattern

| ID | Level | Priority | Test | Justification | Mitigates |
|----|-------|----------|------|---------------|-----------|
| 8.6-UNIT-001 | Unit | P1 | Verify QXmlTreeModel inherits QAbstractItemModel | Core architecture verification - pure class inspection | - |
| 8.6-UNIT-002 | Unit | P1 | Verify all required roles are defined (KeyRole, ValueRole, ValueTypeRole, XmlPathRole, ChildCountRole, IsExpandableRole) | Role enum completeness - static analysis | - |
| 8.6-UNIT-003 | Unit | P1 | Verify roleNames() returns correct mapping | Qt model interface contract | - |
| 8.6-INT-001 | Integration | P1 | Verify model signals (beginResetModel/endResetModel) emit correctly during loadXml | Multi-component flow: model + view binding | - |

### AC2: XML elements displayed as expandable nodes

| ID | Level | Priority | Test | Justification | Mitigates |
|----|-------|----------|------|---------------|-----------|
| 8.6-UNIT-004 | Unit | P0 | Parse `<root/>` returns single element child | Core parsing - pure logic | TECH-001 |
| 8.6-UNIT-005 | Unit | P0 | Parse `<a><b><c/></b></a>` creates correct hierarchy | Nested element parsing - algorithm correctness | TECH-001 |
| 8.6-UNIT-006 | Unit | P1 | IsExpandableRole returns true for elements with children | Data accessor logic | - |
| 8.6-UNIT-007 | Unit | P1 | IsExpandableRole returns false for empty elements | Data accessor logic | - |
| 8.6-INT-002 | Integration | P1 | TreeView delegate renders elements as expandable nodes | Component interaction: model + TreeView.qml | - |

### AC3: XML attributes displayed as child nodes with @ prefix

| ID | Level | Priority | Test | Justification | Mitigates |
|----|-------|----------|------|---------------|-----------|
| 8.6-UNIT-008 | Unit | P0 | Parse `<a b="1"/>` creates attribute child with key "@b" | Core attribute parsing logic | TECH-001 |
| 8.6-UNIT-009 | Unit | P1 | Parse `<a x="1" y="2"/>` creates multiple attribute children | Multiple attributes handling | - |
| 8.6-UNIT-010 | Unit | P1 | Attribute value accessible via ValueRole | Data accessor correctness | - |
| 8.6-UNIT-011 | Unit | P2 | ValueTypeRole returns "attribute" for attribute nodes | Type classification logic | - |

### AC4: Text content displayed as leaf nodes

| ID | Level | Priority | Test | Justification | Mitigates |
|----|-------|----------|------|---------------|-----------|
| 8.6-UNIT-012 | Unit | P0 | Parse `<a>hello</a>` creates text child node | Core text parsing | TECH-001 |
| 8.6-UNIT-013 | Unit | P1 | Text node value accessible via ValueRole | Data accessor correctness | - |
| 8.6-UNIT-014 | Unit | P1 | Mixed content: `<a>text<b/>more</a>` preserves order | Complex content handling | TECH-001 |
| 8.6-UNIT-015 | Unit | P2 | CDATA sections parsed as CData ItemType | CDATA handling | - |
| 8.6-UNIT-016 | Unit | P2 | Comment nodes parsed with Comment ItemType | Comment handling | - |

### AC5: Namespaces and prefixes preserved in display

| ID | Level | Priority | Test | Justification | Mitigates |
|----|-------|----------|------|---------------|-----------|
| 8.6-UNIT-017 | Unit | P1 | Parse `<ns:element xmlns:ns="..."/>` preserves prefix | Namespace parsing logic | TECH-002 |
| 8.6-UNIT-018 | Unit | P1 | NamespacePrefixRole returns "ns" for prefixed elements | Role accessor correctness | TECH-002 |
| 8.6-INT-003 | Integration | P2 | Display shows "ns:element" format in TreeView | View rendering of namespaces | TECH-002 |
| 8.6-UNIT-019 | Unit | P2 | Multiple namespace declarations handled correctly | Complex namespace scenario | TECH-002 |
| 8.6-UNIT-020 | Unit | P2 | Default namespace (xmlns="...") handled without prefix | Edge case handling | TECH-002 |

### AC6: Copy node functionality works (serializes selected node as XML)

| ID | Level | Priority | Test | Justification | Mitigates |
|----|-------|----------|------|---------------|-----------|
| 8.6-UNIT-021 | Unit | P0 | serializeNode() for `<a/>` returns `<a/>` | Core serialization - pure function | - |
| 8.6-UNIT-022 | Unit | P1 | serializeNode() includes child elements | Recursive serialization | - |
| 8.6-UNIT-023 | Unit | P1 | serializeNode() includes attributes | Attribute serialization | - |
| 8.6-UNIT-024 | Unit | P1 | serializeNode() preserves namespace prefixes | Namespace round-trip | TECH-002 |
| 8.6-INT-004 | Integration | P1 | Copy context menu action invokes serializeNode and copies to clipboard | User action integration | - |
| 8.6-E2E-001 | E2E | P2 | User selects node, copies, pastes in text editor - valid XML | Critical user journey | - |

### AC7: Tree view switches between JSON and XML model based on format

| ID | Level | Priority | Test | Justification | Mitigates |
|----|-------|----------|------|---------------|-----------|
| 8.6-INT-005 | Integration | P0 | JsonBridge.xmlTreeModel property is accessible from QML | Bridge integration | - |
| 8.6-INT-006 | Integration | P0 | loadXmlTreeModel() populates xmlTreeModel | Bridge method integration | - |
| 8.6-INT-007 | Integration | P1 | Main.qml switches TreeView.model based on detectedFormat | Format switching logic | OPS-001 |
| 8.6-INT-008 | Integration | P1 | Switching from XML to JSON clears XML model and vice versa | Model cleanup on switch | OPS-001 |
| 8.6-E2E-002 | E2E | P1 | User loads XML, sees tree, loads JSON, sees JSON tree | Full format switch journey | OPS-001 |

### AC8: Performance acceptable for documents up to 10,000 nodes

| ID | Level | Priority | Test | Justification | Mitigates |
|----|-------|----------|------|---------------|-----------|
| 8.6-INT-009 | Integration | P0 | Load 10,000 node document in < 2 seconds | Performance requirement | PERF-001 |
| 8.6-INT-010 | Integration | P1 | Load 1,000 node document - verify memory usage | Memory efficiency baseline | PERF-001 |
| 8.6-E2E-003 | E2E | P1 | UI remains responsive during 10,000 node tree expansion | User experience under load | PERF-001 |
| 8.6-E2E-004 | E2E | P3 | Stress test with 50,000 nodes - graceful handling | Beyond-spec resilience | PERF-001 |

## Additional Scenarios from Risk Profile

### Error Handling & Edge Cases

| ID | Level | Priority | Test | Justification | Mitigates |
|----|-------|----------|------|---------------|-----------|
| 8.6-UNIT-025 | Unit | P0 | Malformed XML `<a><b></a>` returns error with position | Error handling for invalid input | TECH-001 |
| 8.6-UNIT-026 | Unit | P1 | Empty string input returns false, empty model | Edge case handling | TECH-001 |
| 8.6-UNIT-027 | Unit | P2 | Invalid characters in XML return meaningful error | Edge case handling | TECH-001 |
| 8.6-UNIT-028 | Unit | P3 | Deeply nested XML (1000 levels) handles gracefully | Pathological input | PERF-001 |

## Risk Coverage Matrix

| Risk ID | Risk Description | Test IDs Covering |
|---------|-----------------|-------------------|
| PERF-001 | Memory exhaustion on large XML | 8.6-INT-009, 8.6-INT-010, 8.6-E2E-003, 8.6-E2E-004, 8.6-UNIT-028 |
| TECH-001 | QXmlStreamReader edge cases | 8.6-UNIT-004, 8.6-UNIT-005, 8.6-UNIT-008, 8.6-UNIT-012, 8.6-UNIT-014, 8.6-UNIT-025, 8.6-UNIT-026, 8.6-UNIT-027 |
| TECH-002 | Namespace handling complexity | 8.6-UNIT-017, 8.6-UNIT-018, 8.6-UNIT-019, 8.6-UNIT-020, 8.6-UNIT-024, 8.6-INT-003 |
| OPS-001 | TreeView model switching race | 8.6-INT-007, 8.6-INT-008, 8.6-E2E-002 |

## Recommended Execution Order

### Phase 1: Fail Fast (P0 Critical)
1. 8.6-UNIT-004 - Basic element parsing
2. 8.6-UNIT-005 - Nested hierarchy
3. 8.6-UNIT-008 - Attribute parsing
4. 8.6-UNIT-012 - Text content parsing
5. 8.6-UNIT-021 - Basic serialization
6. 8.6-UNIT-025 - Error handling
7. 8.6-INT-005 - Bridge property access
8. 8.6-INT-006 - Bridge method works
9. 8.6-INT-009 - Performance requirement

### Phase 2: Core Functionality (P1)
1. All remaining UNIT tests (P1)
2. All remaining INT tests (P1)
3. 8.6-E2E-002 - Format switching journey
4. 8.6-E2E-003 - Performance UX

### Phase 3: Extended Coverage (P2)
1. All P2 unit tests
2. 8.6-INT-003 - Namespace display
3. 8.6-E2E-001 - Copy/paste journey

### Phase 4: Edge Cases (P3)
1. 8.6-UNIT-028 - Deep nesting
2. 8.6-E2E-004 - Stress test

## Test Data Requirements

### Minimal Test Documents
```xml
<!-- Simple element -->
<root/>

<!-- With attributes -->
<root attr1="value1" attr2="value2"/>

<!-- Nested with text -->
<root>
  <child>Hello World</child>
</root>

<!-- With namespaces -->
<ns:root xmlns:ns="http://example.com">
  <ns:child/>
</ns:root>
```

### Large Test Documents
- 1,000 nodes: Generate via script (balanced tree depth 10, breadth 10)
- 10,000 nodes: Generate via script (balanced tree depth 14, breadth 7)
- 50,000 nodes: Generate via script (for stress testing)

### Malformed Test Documents
```xml
<!-- Unclosed tag -->
<a><b></a>

<!-- Invalid characters -->
<a>&#x0;</a>

<!-- Encoding mismatch -->
<?xml version="1.0" encoding="UTF-16"?>UTF-8 content
```

## Test Environment Requirements

| Component | Requirement |
|-----------|-------------|
| Qt Version | 6.x (matching project) |
| Test Framework | Qt Test |
| Memory Profiler | Valgrind or AddressSanitizer |
| Performance Timer | QElapsedTimer |
| Test Data Generator | Script to generate large XML |
| CI Integration | GitHub Actions (existing) |

## Gate YAML Block

```yaml
test_design:
  scenarios_total: 32
  by_level:
    unit: 18
    integration: 10
    e2e: 4
  by_priority:
    p0: 8
    p1: 14
    p2: 8
    p3: 2
  coverage_gaps: []
  risk_coverage:
    PERF-001: 5
    TECH-001: 8
    TECH-002: 6
    OPS-001: 3
```

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (unit for logic, integration for component interaction, e2e for user journeys)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk (security/data integrity as P0)
- [x] Test IDs follow naming convention (8.6-LEVEL-SEQ)
- [x] Scenarios are atomic and independent
- [x] Risk mitigations are addressed with test mapping

## Trace References

Test design matrix: docs/qa/assessments/8.6-test-design-20260128.md
P0 tests identified: 8
