# NFR Assessment: 8.4 - Format Auto-Detection

**Date:** 2026-01-28
**Reviewer:** Quinn (Test Architect)
**Story:** docs/stories/8.4.format-auto-detection.md
**Mode:** YOLO (non-interactive)

## Summary

| NFR | Status | Notes |
|-----|--------|-------|
| Security | PASS | Client-side string inspection only, no network/storage |
| Performance | PASS | O(whitespace) algorithm, <1ms target achievable |
| Reliability | PASS | Graceful "unknown" fallback, no crash vectors |
| Maintainability | CONCERNS | Test file not yet created |

**Quality Score:** 90/100 (1 CONCERNS = -10)

## Assessment Details

### Security: PASS

**Evidence:**
- Detection is purely local string inspection (first non-whitespace character)
- No network calls per airgap architecture
- No localStorage/IndexedDB usage
- Detection result is constrained enum: "json", "xml", "unknown"
- No user input reaches external systems
- No injection vectors - output is hardcoded string literals

**Verification:**
- Code path is `QString::trimmed()` → `QChar` comparison → return literal
- Aligns with architecture's zero-network requirement

### Performance: PASS

**Target from AC7:** `<1ms for any input size`

**Evidence:**
- Algorithm complexity: O(whitespace_length), not O(input_length)
- `trimmed()` creates a copy but only scans to first non-whitespace
- First character check is O(1)
- No parsing, no regex, no heavy operations
- Detection is synchronous, non-blocking

**Verification approach:**
- Add performance test: 1MB input should complete <1ms
- Monitor via browser Performance API in dev mode

### Reliability: PASS

**Evidence:**
- Empty input → "unknown" (handled)
- Whitespace-only → "unknown" (handled after trim)
- Unknown format → defaults to JSON (safe fallback per AC4)
- `formatDetected` signal follows standard Qt signal/slot pattern
- No crash scenarios in simple character comparison logic

**Edge cases covered:**
- JSON objects: `{...}` → "json"
- JSON arrays: `[...]` → "json"
- XML elements: `<...` → "xml"
- XML declarations: `<?xml...` → "xml"
- HTML doctype: `<!DOCTYPE...` → "xml" (documented decision)
- Primitives (`null`, `123`, `"string"`) → "unknown"

### Maintainability: CONCERNS

**Issue:** Test file not yet created

**Evidence:**
- Story specifies `qt/tests/tst_format_detection.cpp` (new file)
- File does not exist in codebase
- 9 test cases defined in story but not implemented

**Risk:** Without tests, detection edge cases may regress

**Recommended fix:**
- Create test file with all 9 specified test cases
- Add to CMakeLists.txt test target
- Run tests in CI

## Critical Issues

None.

## Recommendations

1. **Create test file** (Maintainability)
   - Path: `qt/tests/tst_format_detection.cpp`
   - Include all 9 test cases from story
   - Add performance test for <1ms requirement

2. **Document detection limitations** (Reliability/UX)
   - JSON primitives (`null`, `123`) return "unknown"
   - HTML treated as XML (may surprise users)

3. **Consider debounce** (Performance)
   - Detection on every keystroke may be excessive
   - Consider debouncing at 100-300ms in QML integration

## Gate YAML Block

```yaml
# Gate YAML (copy/paste):
nfr_validation:
  _assessed: [security, performance, reliability, maintainability]
  security:
    status: PASS
    notes: 'Client-side string inspection only, no network/storage, hardcoded return values'
  performance:
    status: PASS
    notes: 'O(whitespace) algorithm, <1ms target per AC7, no heavy operations'
  reliability:
    status: PASS
    notes: 'Graceful unknown fallback, empty/whitespace handled, no crash vectors'
  maintainability:
    status: CONCERNS
    notes: 'Test file qt/tests/tst_format_detection.cpp not yet created'
```

---

NFR assessment: docs/qa/assessments/8.4-nfr-20260128.md

Gate NFR block ready → paste into docs/qa/gates/8.4-format-auto-detection.yml under nfr_validation
