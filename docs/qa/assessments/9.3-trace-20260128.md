# Requirements Traceability Matrix

## Story: 9.3 - Share Button UI Integration

**Date:** 2026-01-28
**Traced by:** Quinn (Test Architect)
**Status:** DRAFT

---

## Coverage Summary

| Metric | Count | Percentage |
|--------|-------|------------|
| **Total Requirements (ACs)** | 16 | 100% |
| Fully Covered | 16 | 100% |
| Partially Covered | 0 | 0% |
| Not Covered | 0 | 0% |

**Mapping Source:** Test design assessment (docs/qa/assessments/9.3-test-design-20260128.md)

---

## Requirement Mappings

### AC1: Share button added to Toolbar.qml in the right zone

**Coverage: FULL** | **Tests: 2**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-INT-001 | Integration | **Given** Toolbar.qml is rendered **When** examining button order **Then** Share button appears between separator and Copy button |
| 9.3-E2E-001 | E2E | **Given** Application loaded **When** viewing toolbar **Then** Share button styling matches existing outline button pattern |

---

### AC2: Share button disabled when input empty or invalid JSON

**Coverage: FULL** | **Tests: 4**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-UNIT-001 | Unit | **Given** Input pane is empty **When** evaluating canShare property **Then** Returns false |
| 9.3-UNIT-002 | Unit | **Given** Input pane contains invalid JSON **When** evaluating canShare property **Then** Returns false |
| 9.3-INT-002 | Integration | **Given** canShare property is false **When** examining Share button **Then** Button is disabled with reduced opacity |
| 9.3-INT-003 | Integration | **Given** Valid JSON in input pane **When** evaluating canShare property **Then** Share button becomes enabled |

---

### AC3: Share button tooltip shows security warning

**Coverage: FULL** | **Tests: 2**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-INT-004 | Integration | **Given** User hovers over Share button **When** tooltip appears **Then** Text contains "Time-bounded encrypted link (5 min). Anyone with link can view unless passphrase-protected." |
| 9.3-E2E-002 | E2E | **Given** User hovers over Share button **When** waiting **Then** Tooltip appears after 500ms delay |

---

### AC4: ShareDialog.qml with passphrase option

**Coverage: FULL** | **Tests: 4**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-INT-005 | Integration | **Given** Valid JSON loaded **When** Share button clicked **Then** ShareDialog modal opens |
| 9.3-INT-006 | Integration | **Given** ShareDialog is open **When** examining dialog **Then** Passphrase field is displayed with placeholder text |
| 9.3-INT-007 | Integration | **Given** ShareDialog is open **When** Share button clicked **Then** `shareConfirmed(passphrase)` signal emitted with passphrase value |
| 9.3-INT-008 | Integration | **Given** ShareDialog is open **When** Cancel button clicked **Then** `cancelled()` signal emitted |

---

### AC5: Quick share URL format

**Coverage: FULL** | **Tests: 3**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-UNIT-003 | Unit | **Given** No passphrase provided **When** constructing share URL **Then** Format is `?d={data}#{key}` with key in fragment only |
| 9.3-INT-009 | Integration | **Given** JSON content and empty passphrase **When** calling `createShareUrl()` **Then** Returns URL with mode="quick" and key in fragment |
| 9.3-E2E-003 | E2E | **Given** Valid JSON **When** quick share generated **Then** URL format valid and key accessible from fragment across all browsers |

---

### AC6: Protected share URL format

**Coverage: FULL** | **Tests: 3**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-UNIT-004 | Unit | **Given** Passphrase provided **When** constructing share URL **Then** Format is `?d={data}&p=1` with NO key in URL |
| 9.3-INT-010 | Integration | **Given** JSON content and passphrase **When** calling `createShareUrl()` **Then** Returns URL with mode="protected" and p=1 flag |
| 9.3-E2E-004 | E2E | **Given** Valid JSON and passphrase **When** protected share generated **Then** URL contains no key fragment, only data and p=1 |

---

### AC7: URL copied to clipboard with mode-specific message

**Coverage: FULL** | **Tests: 6**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-INT-011 | Integration | **Given** Share operation succeeds **When** URL generated **Then** URL is copied to clipboard via Clipboard API |
| 9.3-E2E-005 | E2E | **Given** Chrome 90+ **When** share URL copied **Then** Clipboard contains valid URL |
| 9.3-E2E-006 | E2E | **Given** Firefox 88+ **When** share URL copied **Then** Clipboard contains valid URL |
| 9.3-E2E-007 | E2E | **Given** Safari 14+ with user gesture **When** share URL copied **Then** Clipboard contains valid URL |
| 9.3-E2E-008 | E2E | **Given** Edge 90+ **When** share URL copied **Then** Clipboard contains valid URL |
| 9.3-INT-012 | Integration | **Given** Quick share succeeds **When** status bar updates **Then** Shows "Share link copied! Expires in 5 min" (green) |
| 9.3-INT-013 | Integration | **Given** Protected share succeeds **When** status bar updates **Then** Shows "Protected share link copied! Recipient needs passphrase" (green) |

---

### AC8: JSON too large error

**Coverage: FULL** | **Tests: 2**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-UNIT-005 | Unit | **Given** URL would exceed 8000 characters **When** share URL construction attempted **Then** Returns error with "too large" message |
| 9.3-INT-014 | Integration | **Given** JSON exceeds ~50KB **When** share attempted **Then** ShareDialog shows "JSON too large to share (max ~50KB)" error |

---

### AC9: Startup detection of share URL

**Coverage: FULL** | **Tests: 3**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-UNIT-006 | Unit | **Given** URL has `?d=` parameter **When** `getShareParams()` called **Then** Returns `hasShareData: true` with decoded data |
| 9.3-UNIT-007 | Unit | **Given** URL has `p=1` flag **When** `getShareParams()` called **Then** Returns `isProtected: true` |
| 9.3-UNIT-008 | Unit | **Given** URL has `#key` fragment **When** `getShareParams()` called **Then** Returns key extracted from fragment |

---

### AC10: PassphrasePrompt for protected links

**Coverage: FULL** | **Tests: 2**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-INT-015 | Integration | **Given** URL contains `p=1` flag **When** application starts **Then** PassphrasePrompt.qml modal is displayed |
| 9.3-E2E-009 | E2E | **Given** PassphrasePrompt displayed **When** examining passphrase field **Then** Field uses password masking (echoMode: Password) |

---

### AC11: Valid share link loads JSON

**Coverage: FULL** | **Tests: 3**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-INT-016 | Integration | **Given** Valid quick share URL **When** application loads **Then** JSON extracted and loaded into input pane |
| 9.3-INT-017 | Integration | **Given** Valid protected share URL and correct passphrase **When** passphrase entered **Then** JSON decrypted and loaded into input pane |
| 9.3-E2E-010 | E2E | **Given** Share link loaded successfully **When** JSON appears **Then** Auto-format triggered and output pane updated |

---

### AC12: Expired link message

**Coverage: FULL** | **Tests: 2**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-INT-018 | Integration | **Given** Share URL with timestamp >5 min old **When** decode attempted **Then** Returns expired error code |
| 9.3-E2E-011 | E2E | **Given** Expired share link **When** application loads **Then** Shows "This share link has expired (links valid for 5 minutes)" message |

---

### AC13: Wrong passphrase handling

**Coverage: FULL** | **Tests: 2**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-E2E-012 | E2E | **Given** Protected share link and wrong passphrase **When** passphrase submitted **Then** Shows "Incorrect passphrase" error in dialog |
| 9.3-E2E-013 | E2E | **Given** "Incorrect passphrase" shown **When** user modifies passphrase **Then** Retry is allowed, correct passphrase succeeds |

---

### AC14: Invalid/corrupted link handling

**Coverage: FULL** | **Tests: 2**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-E2E-014 | E2E | **Given** Share link with corrupted base64 data **When** decode attempted **Then** Shows "Invalid or corrupted share link" message |
| 9.3-E2E-015 | E2E | **Given** Truncated or malformed URL **When** decode attempted **Then** Error handled gracefully, no crash |

---

### AC15: Keyboard shortcut Ctrl+Shift+S

**Coverage: FULL** | **Tests: 1**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-E2E-016 | E2E | **Given** Valid JSON loaded **When** Ctrl+Shift+S pressed **Then** ShareDialog opens |

---

### AC16: Cross-browser testing

**Coverage: FULL** | **Tests: 4**

| Test ID | Level | G-W-T Description |
|---------|-------|-------------------|
| 9.3-E2E-017 | E2E | **Given** Chrome 90+ **When** full quick share flow executed **Then** Share, copy, and decode all function correctly |
| 9.3-E2E-018 | E2E | **Given** Firefox 88+ **When** full protected share flow executed **Then** Share, copy, passphrase entry, and decode all function correctly |
| 9.3-E2E-019 | E2E | **Given** Safari 14+ **When** quick share with fragment executed **Then** URL fragment preserved during navigation |
| 9.3-E2E-020 | E2E | **Given** Edge 90+ **When** full share flow executed **Then** All share modes function correctly |

---

## Coverage Gaps

**NONE IDENTIFIED**

All 16 acceptance criteria have corresponding test coverage at appropriate levels.

---

## Risk Traceability

| Risk ID | Risk Title | Test Coverage | Status |
|---------|------------|---------------|--------|
| SEC-001 | URL fragment key leakage | 9.3-INT-004, 9.3-UNIT-003, 9.3-E2E-004 | COVERED |
| SEC-002 | Passphrase exposure in DOM | 9.3-E2E-009 | COVERED |
| SEC-003 | Browser history/referer leakage | Implicitly covered by `clearShareParams()` call verification | COVERED |
| TECH-001 | Clipboard cross-browser | 9.3-E2E-005 through 9.3-E2E-008 | COVERED |
| TECH-002 | URL length limits | 9.3-UNIT-005, 9.3-INT-014 | COVERED |
| OPS-001 | PBKDF2 blocking UI | Manual verification during passphrase tests | INDIRECT |
| UX-001 | Passphrase dialog UX | 9.3-E2E-012, 9.3-E2E-013 | COVERED |

---

## Implementation Status Notes

**Story Status:** DRAFT (not implemented)

The following files are planned but not yet created:
- `qt/qml/ShareDialog.qml` - NEW
- `qt/qml/PassphrasePrompt.qml` - NEW
- `public/bridge.js` - Share functions not yet added

**Tests Status:** Designed but not implemented. Test design covers all ACs with 42 scenarios across unit/integration/E2E levels.

---

## Recommendations

1. **Implementation Priority Order:**
   - Task 1 (bridge.js) → enables all WASM integration tests
   - Task 2-3 (QML dialogs) → enables integration tests
   - Task 4-6 (wiring) → enables E2E tests
   - Task 7-8 (polish) → enables remaining tests

2. **Test Implementation Order:**
   - P0 unit tests first (8 tests) - validate URL construction logic
   - P0 integration tests (6 tests) - validate bridge/QML wiring
   - P1 tests for core flows
   - P2/P3 for polish and edge cases

3. **Special Attention Areas:**
   - Safari clipboard API requires user gesture context
   - PBKDF2 timing (1-3s) may need loading indicator
   - Cross-browser fragment handling in Safari

---

## Gate YAML Block

```yaml
trace:
  totals:
    requirements: 16
    full: 16
    partial: 0
    none: 0
  coverage_percentage: 100%
  test_scenarios: 42
  uncovered: []
  notes: 'Full traceability established. All 16 ACs mapped to tests. See docs/qa/assessments/9.3-trace-20260128.md'
```

---

**Trace matrix:** docs/qa/assessments/9.3-trace-20260128.md

**Reviewed by:** Quinn (Test Architect) — 2026-01-28
