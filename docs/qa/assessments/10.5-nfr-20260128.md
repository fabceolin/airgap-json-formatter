# NFR Assessment: 10.5 - Markdown Preview Pane (v2)

Date: 2026-01-28
Reviewer: Quinn (Test Architect)
Mode: YOLO (Non-interactive, Core Four NFRs)
Story Version: v1.3 (Post-Architect Corrections)

## Summary

- Security: PASS - Defense-in-depth sanitization via AC10, CSP configuration
- Performance: PASS - 200ms/500KB SLA defined in AC11
- Reliability: CONCERNS - No explicit error display AC for invalid/rejected HTML
- Maintainability: PASS - Test strategy documented, modular architecture

**Quality Score: 90/100**

## Detailed Assessment

### Security (PASS)

**Evidence:**
1. **AC10 (Defense-in-Depth)**: Explicit sanitization verification requirement
   - Reject: `<script>`, `<iframe>`, `<object>`, `<embed>` tags
   - Strip: `on*` event handlers
   - Neutralize: `javascript:` URLs

2. **Task 4 (CSP)**: WebEngineView configuration
   - `script-src 'none'; object-src 'none'`
   - URL request interceptor for non-local requests

3. **AC5**: External image blocking with placeholder
4. **Link Navigation**: `pointer-events: none` in CSS
5. **Primary Sanitization**: DOMPurify in Bridge Layer (Story 10.3)

**Previous Gap Resolved:**
- ~~No explicit HTML sanitization AC~~ → AC10 added in v1.2

**Validation Approach:**
- OWASP XSS payload test suite
- Network traffic monitoring during preview
- SVG-based XSS vector testing

### Performance (PASS)

**Evidence:**
1. **AC11**: 200ms render target for documents up to 500KB
2. **AC9**: 300ms debounce for preview updates
3. **Task 7**: Performance instrumentation and timing measurement
4. **AC8**: Smooth scrolling for large documents

**Previous Gap Resolved:**
- ~~Missing explicit render time targets~~ → AC11 added in v1.2

**Thresholds:**
- Render time: < 200ms (500KB document)
- Debounce interval: 300ms
- Scroll performance: 60fps target (implied by "smooth scrolling")

**Validation Approach:**
- Performance API timing instrumentation
- Large document stress testing
- Frame rate monitoring during scroll

### Reliability (CONCERNS)

**Evidence:**
1. Fallback views available (Code ↔ Preview toggle)
2. Error styling for Mermaid diagram failures (`.mermaid-error` CSS class)
3. TextArea alternative if WebEngineView unavailable

**Gaps:**
1. **No explicit AC for error display** when:
   - HTML is malformed
   - Defense-in-depth sanitization rejects content
   - WebEngineView fails to load content

2. **Missing graceful degradation specification** for:
   - Documents exceeding 500KB (behavior undefined)
   - Memory exhaustion scenarios

**Risk:** User sees blank pane with no feedback when content is rejected.

**Recommended AC Addition:**
> "When HTML fails sanitization or cannot be rendered, display a clear error message in the preview pane explaining the issue."

### Maintainability (PASS)

**Evidence:**
1. **Task 8**: Integration testing approach documented
2. **Component Separation**: OutputPane.qml, MarkdownPreview.qml (proposed)
3. **Theme Integration**: CSS variables mapped from Theme.qml
4. **Test Matrix**: 34 tests across unit/integration/E2E in existing QA Notes

**Previous Gap Status:**
- ~~Only manual test procedure defined~~ → Test Design section now documents 34 tests
- ~~No automated test specifications~~ → Task 8 specifies integration testing approach

**Test Coverage:**
- Security: 6 dedicated tests
- Performance: 4 tests
- Functional: 24 tests

## Critical Issues

1. **Reliability Gap - Error Display** (Medium)
   - Risk: User confusion when content silently fails to render
   - Fix: Add AC for error message display on sanitization/render failure
   - Priority: Medium (not blocking, but improves UX)

## Quick Wins

- Add error display AC: ~30 minutes to document
- Define >500KB graceful degradation: ~1 hour to document and implement

## Gate YAML Block

```yaml
# Gate YAML (copy/paste):
nfr_validation:
  _assessed: [security, performance, reliability, maintainability]
  security:
    status: PASS
    notes: 'AC10 defense-in-depth + AC5 image blocking + CSP in Task 4'
  performance:
    status: PASS
    notes: 'AC11 defines 200ms/500KB SLA, AC9 defines 300ms debounce'
  reliability:
    status: CONCERNS
    notes: 'No explicit AC for error display when HTML rejected/malformed'
  maintainability:
    status: PASS
    notes: 'Task 8 integration testing, modular component architecture'
```

## Comparison with Previous Assessment

| NFR | Previous (v1.0) | Current (v1.3) | Delta |
|-----|-----------------|----------------|-------|
| Security | CONCERNS | PASS | +10 pts (AC10 added) |
| Performance | CONCERNS | PASS | +10 pts (AC11 added) |
| Reliability | PASS | CONCERNS | -10 pts (stricter eval) |
| Maintainability | CONCERNS | PASS | +10 pts (test strategy) |
| **Total** | **70/100** | **90/100** | **+20 pts** |

**Note:** Reliability downgrade reflects more rigorous assessment of error display requirements, not a regression in the story.

---

NFR assessment: docs/qa/assessments/10.5-nfr-20260128.md
Gate NFR block ready → paste into docs/qa/gates/10.5-markdown-preview-pane.yml under nfr_validation
