# Risk Profile: Story 9.1 - Rust Share Encoding Module

Date: 2026-01-28
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 9
- Critical Risks: 0
- High Risks: 3
- Risk Score: 51/100 (Moderate)

## High Risks Requiring Attention

### 1. SEC-001: Incorrect AES-GCM cryptographic implementation

**Score: 6 (High)**
**Probability**: Medium - Crypto APIs are notoriously easy to misuse; nonce reuse, wrong mode, or authentication tag handling errors are common.
**Impact**: High - Broken encryption means sensitive JSON data (API keys, PII, credentials) could be exposed in transit.
**Mitigation**:
- Use well-audited crate APIs exactly as documented (aes-gcm 0.10)
- Ensure nonce is always freshly generated per encryption call
- Verify authentication tag is included and checked on decryption
- Add round-trip tests that tamper with ciphertext to verify integrity check
**Testing Focus**: Round-trip tests, ciphertext tampering tests, nonce uniqueness verification

### 2. TECH-001: WASM compatibility with crypto crates

**Score: 6 (High)**
**Probability**: Medium - getrandom requires `js` feature for WASM; aes-gcm and pbkdf2 may have platform-specific codepaths.
**Impact**: High - Build failure or runtime panic would completely block the feature.
**Mitigation**:
- Verify WASM build early (Task 1 includes this)
- Test in browser environment, not just native
- Pin exact crate versions to known-good WASM-compatible releases
**Testing Focus**: WASM build verification, browser runtime smoke test

### 3. PERF-001: PBKDF2 100K iterations blocking WASM main thread

**Score: 6 (High)**
**Probability**: High - PBKDF2 with 100K iterations is computationally expensive; WASM runs on main thread.
**Impact**: Medium - UI freeze during passphrase-mode share creation; poor UX but not data loss.
**Mitigation**:
- Benchmark PBKDF2 duration in WASM (target < 500ms)
- Consider Web Worker offloading in future story if too slow
- Document expected latency for passphrase mode
**Testing Focus**: Performance benchmark test, UI responsiveness during passphrase mode

## Risk Distribution

### By Category

- Security: 4 risks (0 critical, 2 high)
- Technical: 2 risks (0 critical, 1 high)
- Performance: 1 risk (0 critical, 1 high)
- Data: 1 risk (0 critical, 0 high)
- Operational: 1 risk (0 critical, 0 high)

### By Component

- Rust/WASM Core: 8 risks
- JavaScript Bridge: 1 risk

## Detailed Risk Register

| Risk ID  | Description                                          | Prob    | Impact  | Score | Priority |
|----------|------------------------------------------------------|---------|---------|-------|----------|
| SEC-001  | Incorrect AES-GCM implementation                     | Med (2) | High (3)| 6     | High     |
| TECH-001 | WASM compatibility with crypto crates                | Med (2) | High (3)| 6     | High     |
| PERF-001 | PBKDF2 blocking main thread in WASM                  | High (3)| Med (2) | 6     | High     |
| SEC-003  | Timestamp enabling replay within 5-min window        | Med (2) | Med (2) | 4     | Medium   |
| OPS-001  | WASM binary size exceeds 150KB budget                | Med (2) | Med (2) | 4     | Medium   |
| SEC-004  | Key material exposure in JS memory                   | Med (2) | Med (2) | 4     | Medium   |
| SEC-002  | PBKDF2 key derivation flaw                           | Low (1) | High (3)| 3     | Low      |
| TECH-002 | Compression-before-encryption oracle                 | Low (1) | Med (2) | 2     | Low      |
| DATA-001 | 6000 char payload limit too restrictive               | Med (2) | Low (1) | 2     | Low      |

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests
- Crypto round-trip for both modes (random key + passphrase)
- Ciphertext tampering detection (flip bits, verify decryption fails)
- Nonce uniqueness across multiple calls
- WASM build + browser runtime smoke test
- PBKDF2 performance benchmark in WASM

### Priority 2: Medium Risk Tests
- Timestamp validation (within expected range)
- WASM binary size measurement
- Key material lifecycle in JS (verify no persistence after use)

### Priority 3: Low Risk Tests
- Payload size boundary testing (near 6000 char limit)
- Compression ratio verification
- Edge cases: empty input, unicode, very large JSON

## Risk Acceptance Criteria

### Must Fix Before Production
- All High risks (SEC-001, TECH-001, PERF-001) must have verified mitigations

### Can Deploy with Mitigation
- Medium risks (SEC-003, OPS-001, SEC-004) acceptable with monitoring and documentation

### Accepted Risks
- TECH-002 (compression oracle): Low practical risk in this context since attacker cannot inject chosen plaintext
- DATA-001 (payload limit): By design per AC 10; users informed via error message

## Monitoring Requirements

- WASM binary size tracked per build
- Browser console errors during share operations
- Share success/failure rates (client-side metrics if applicable)

## Risk Review Triggers

- If crypto crate versions are updated
- If WASM target or toolchain changes
- If payload format changes for Story 9.2 (decoding)
