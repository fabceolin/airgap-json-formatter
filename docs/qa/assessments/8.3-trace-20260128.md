# Requirements Traceability Matrix

## Story: 8.3 - Bridge Layer XML Methods

**Assessment Date**: 2026-01-28
**Reviewer**: Quinn (Test Architect)
**Story Status**: Approved (NOT IMPLEMENTED)

---

## Critical Finding

**STORY NOT IMPLEMENTED** - The Qt Bridge layer (jsonbridge.h/cpp) does not contain any XML methods. This trace documents the gap between requirements and implementation.

---

## Coverage Summary

| Metric | Count | Percentage |
|--------|-------|------------|
| Total Requirements | 7 | 100% |
| Fully Covered | 0 | 0% |
| Partially Covered | 0 | 0% |
| Not Covered | 7 | 100% |

---

## Requirement Mappings

### AC1: `formatXml(input, indentType)` method added to JsonBridge

**Coverage: NONE**

| Artifact | Status | Evidence |
|----------|--------|----------|
| jsonbridge.h | NOT FOUND | No `formatXml` declaration |
| jsonbridge.cpp | NOT FOUND | No `formatXml` implementation |
| Unit Tests | NOT FOUND | No `tst_jsonbridge_xml.cpp` |
| Integration Tests | NOT FOUND | No test coverage |

**Given-When-Then Mapping (Expected):**
- **Given**: JsonBridge instance initialized, valid XML input
- **When**: `formatXml("<root/>", "spaces:2")` is called
- **Then**: Task enqueued to AsyncSerialiser, `formatXmlCompleted` signal emitted with formatted XML

**Dependency Check:**
- Rust WASM export: `js_format_xml` in lib.rs:160-165
- JS Bridge wrapper: **NOT FOUND** in bridge.js

---

### AC2: `minifyXml(input)` method added to JsonBridge

**Coverage: NONE**

| Artifact | Status | Evidence |
|----------|--------|----------|
| jsonbridge.h | NOT FOUND | No `minifyXml` declaration |
| jsonbridge.cpp | NOT FOUND | No `minifyXml` implementation |
| Unit Tests | NOT FOUND | No test coverage |
| Integration Tests | NOT FOUND | No test coverage |

**Given-When-Then Mapping (Expected):**
- **Given**: JsonBridge instance initialized, valid XML input with whitespace
- **When**: `minifyXml("<root>\n  <child/>\n</root>")` is called
- **Then**: Task enqueued to AsyncSerialiser, `minifyXmlCompleted` signal emitted with minified XML

**Dependency Check:**
- Rust WASM export: `js_minify_xml` in lib.rs:175-179
- JS Bridge wrapper: **NOT FOUND** in bridge.js

---

### AC3: `highlightXml(input)` synchronous method added to JsonBridge

**Coverage: NONE**

| Artifact | Status | Evidence |
|----------|--------|----------|
| jsonbridge.h | NOT FOUND | No `highlightXml` declaration |
| jsonbridge.cpp | NOT FOUND | No `highlightXml` implementation |
| Unit Tests | NOT FOUND | No test coverage |
| Integration Tests | NOT FOUND | No test coverage |

**Given-When-Then Mapping (Expected):**
- **Given**: JsonBridge instance initialized, XML input
- **When**: `highlightXml("<root attr=\"value\"/>")` is called
- **Then**: Returns HTML string with syntax highlighting spans (synchronous)

**Dependency Check:**
- Rust WASM export: `js_highlight_xml` in lib.rs:188-191
- JS Bridge wrapper: **NOT FOUND** in bridge.js

---

### AC4: Async methods emit completion signals with result/error

**Coverage: NONE**

| Artifact | Status | Evidence |
|----------|--------|----------|
| jsonbridge.h signals | NOT FOUND | No `formatXmlCompleted` or `minifyXmlCompleted` signals |
| jsonbridge.cpp emit | NOT FOUND | No signal emissions |
| Unit Tests | NOT FOUND | No signal testing |

**Given-When-Then Mapping (Expected):**
- **Given**: formatXml called with invalid XML `<root`
- **When**: AsyncSerialiser task completes
- **Then**: `formatXmlCompleted` emitted with `{success: false, error: "..."}`

---

### AC5: All XML methods integrate with AsyncSerialiser pattern

**Coverage: NONE**

| Artifact | Status | Evidence |
|----------|--------|----------|
| AsyncSerialiser.enqueue | NOT FOUND | No XML methods use enqueue |
| QPromise handling | NOT FOUND | No promise setup for XML |
| Watchdog timeout | NOT FOUND | Not applicable without implementation |

**Given-When-Then Mapping (Expected):**
- **Given**: Multiple XML operations queued rapidly
- **When**: User calls `formatXml`, `minifyXml` in succession
- **Then**: Operations execute in FIFO order, one at a time

**Reference Pattern (from jsonbridge.cpp:300-363):**
```cpp
void JsonBridge::formatJson(const QString &input, const QString &indentType)
{
    AsyncSerialiser::instance().enqueue("formatJson", [this, input, indentType]() {
        // ... implementation follows this pattern
    });
}
```

---

### AC6: Existing JSON methods continue to work unchanged

**Coverage: PARTIAL (via existing tests)**

| Artifact | Status | Evidence |
|----------|--------|----------|
| JSON methods | PASS | `formatJson`, `minifyJson`, `highlightJson`, `validateJson` exist |
| Existing tests | PASS | `tst_jsonbridge_async.cpp` covers JSON operations |
| Regression tests | NOT FOUND | No specific regression tests for AC6 |

**Given-When-Then Mapping:**
- **Given**: XML methods added to JsonBridge
- **When**: `formatJson("{\"a\":1}", "spaces:4")` is called
- **Then**: JSON formatting works identically to before

**Existing Test Coverage:**
- `testFormatJsonUsesAsyncSerialiser` (line 39)
- `testMinifyJsonUsesAsyncSerialiser` (line 86)
- `testValidateJsonUsesAsyncSerialiser` (line 101)

---

### AC7: Bridge compiles for both native and WASM targets

**Coverage: NONE (cannot verify without implementation)**

| Artifact | Status | Evidence |
|----------|--------|----------|
| Native build | NOT TESTABLE | XML methods not added |
| WASM build | NOT TESTABLE | XML methods not added |
| CMakeLists.txt | NO CHANGES | No XML-specific build requirements identified |

**Given-When-Then Mapping (Expected):**
- **Given**: XML methods implemented following existing pattern
- **When**: `cmake .. && make` (native) or `emcmake cmake .. && make` (WASM)
- **Then**: Build succeeds with no errors or warnings

---

## Critical Gaps

### Gap 1: Complete Implementation Missing (SEVERITY: CRITICAL)

**Gap**: Story 8.3 has not been implemented. The Qt Bridge layer is missing all XML method declarations, implementations, and signals.

**Risk Level**: HIGH - Story cannot pass QA gate without implementation

**Affected Requirements**: AC1, AC2, AC3, AC4, AC5, AC7

**Action Required**:
1. Add XML method declarations to `jsonbridge.h`
2. Implement XML methods in `jsonbridge.cpp`
3. Add XML signals to `jsonbridge.h`
4. Follow existing `formatJson()` pattern exactly

### Gap 2: JavaScript Bridge Missing XML Methods (SEVERITY: HIGH)

**Gap**: The `bridge.js` file does not expose `formatXml`, `minifyXml`, or `highlightXml` methods to Qt/QML.

**Risk Level**: HIGH - WASM target will not work without JS bridge wrappers

**Action Required**:
Add to `bridge.js`:
```javascript
formatXml(input, indentType) {
    // Follow formatJson pattern
}
minifyXml(input) {
    // Follow minifyJson pattern
}
highlightXml(input) {
    // Follow highlightJson pattern
}
```

### Gap 3: No Test Coverage (SEVERITY: HIGH)

**Gap**: No test file `tst_jsonbridge_xml.cpp` exists. The test matrix from Test Design (8.3-test-design-20260128.md) specifies 28 test scenarios, none of which are implemented.

**Risk Level**: HIGH - Cannot verify AC1-AC7 without tests

**Action Required**:
1. Create `qt/tests/tst_jsonbridge_xml.cpp`
2. Implement P0 tests first (6 critical tests)
3. Add JSON regression tests for AC6

---

## Dependency Analysis

| Component | Status | Notes |
|-----------|--------|-------|
| Rust xml_formatter.rs | READY | `format_xml`, `minify_xml` functions exist |
| Rust xml_highlighter.rs | READY | `highlight_xml` function exists |
| lib.rs WASM exports | READY | `js_format_xml`, `js_minify_xml`, `js_highlight_xml` exist |
| bridge.js | NOT READY | Missing XML wrapper methods |
| jsonbridge.h | NOT READY | Missing XML declarations |
| jsonbridge.cpp | NOT READY | Missing XML implementations |
| Test suite | NOT READY | No XML tests exist |

---

## Test Design Traceability

From `docs/qa/assessments/8.3-test-design-20260128.md`:

| Test ID | AC | Type | Status |
|---------|-----|------|--------|
| 8.3-INT-001 | AC1 | Integration | NOT IMPLEMENTED |
| 8.3-INT-003 | AC1 | Integration | NOT IMPLEMENTED |
| 8.3-INT-005 | AC2 | Integration | NOT IMPLEMENTED |
| 8.3-INT-009 | AC3 | Integration | NOT IMPLEMENTED |
| 8.3-E2E-001 | AC6 | E2E | PARTIAL (existing JSON tests) |
| 8.3-E2E-004 | AC7 | E2E | NOT IMPLEMENTED |
| 8.3-E2E-005 | AC7 | E2E | NOT IMPLEMENTED |

---

## Risk Assessment Summary

| Risk Level | Count | Requirements |
|------------|-------|--------------|
| HIGH | 6 | AC1, AC2, AC3, AC4, AC5, AC7 |
| MEDIUM | 1 | AC6 (partial coverage) |
| LOW | 0 | - |

---

## Recommendations

### Immediate Actions (Before Implementation)

1. **Verify story status** - Confirm story is meant to be "Approved" not "In Progress"
2. **Review sprint planning** - Story may need to be assigned for implementation

### Implementation Actions

1. **Follow existing patterns exactly** - Copy `formatJson()` structure for `formatXml()`
2. **Add JS bridge methods first** - Required for WASM target
3. **Implement Qt bridge methods** - Follow AsyncSerialiser pattern
4. **Create test file** - `qt/tests/tst_jsonbridge_xml.cpp`

### Testing Actions

1. **Implement P0 tests first** - Core functionality verification
2. **Add JSON regression tests** - Explicit AC6 coverage
3. **Test both build targets** - Native and WASM

---

## Gate YAML Block

```yaml
trace:
  totals:
    requirements: 7
    full: 0
    partial: 1
    none: 6
  planning_ref: 'docs/qa/assessments/8.3-test-design-20260128.md'
  uncovered:
    - ac: 'AC1'
      reason: 'formatXml method not implemented in jsonbridge.h/cpp'
    - ac: 'AC2'
      reason: 'minifyXml method not implemented in jsonbridge.h/cpp'
    - ac: 'AC3'
      reason: 'highlightXml method not implemented in jsonbridge.h/cpp'
    - ac: 'AC4'
      reason: 'XML signals not declared in jsonbridge.h'
    - ac: 'AC5'
      reason: 'No AsyncSerialiser integration for XML methods'
    - ac: 'AC7'
      reason: 'Cannot verify build without implementation'
  notes: 'CRITICAL: Story not implemented. All requirements have zero coverage.'
```

---

## Story Hook Line

```text
Trace matrix: docs/qa/assessments/8.3-trace-20260128.md
```
