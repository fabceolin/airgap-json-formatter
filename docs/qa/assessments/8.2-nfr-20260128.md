# NFR Assessment: 8.2

Date: 2026-01-28
Reviewer: Quinn

## Summary

- Security: CONCERNS - Single quote (`'`) not escaped in `push_colored_escaped()`; XSS vector in attribute contexts
- Performance: CONCERNS - No benchmarks exist; <100ms target for >100KB unverified
- Reliability: CONCERNS - Infinite loop risk in `TagOpen` else branch; malformed input tests not yet implemented
- Maintainability: PASS - Clean state machine, 8 unit tests, good documentation

## Critical Issues

1. **Single quote not escaped** (Security)
   - Risk: XSS in HTML attribute contexts using single quotes
   - Fix: Add `'\'' => output.push_str("&#39;")` to `push_colored_escaped()` match block (line 360)
   - AC #4 explicitly requires this

2. **Infinite loop on malformed input** (Reliability)
   - Risk: Browser tab hangs on `<` followed by control characters
   - Fix: Add `i += 1;` to `State::TagOpen` else branch (line 113-116)
   - AC #3 requires graceful degradation

3. **No performance benchmarks** (Performance)
   - Risk: Cannot verify AC #5 (<100ms for >100KB)
   - Fix: Implement Task 4 benchmark tests

## Minor Issues

1. **Buffer flush uses wrong color** for `TagName`, `AttrName`, `AttrValue`, `InTag` states at end-of-input (line 299-304 `_ => colors::TEXT`)
2. **`matches_str` re-collects pattern chars** on every call (line 315) - minor perf overhead
3. **`push_colored()` bypasses escaping** - safe with current callers but fragile

## Gate YAML Block

```yaml
nfr_validation:
  _assessed: [security, performance, reliability, maintainability]
  security:
    status: CONCERNS
    notes: "Single quote not escaped in push_colored_escaped(); XSS in attribute contexts"
  performance:
    status: CONCERNS
    notes: "No benchmarks exist; <100ms target for >100KB documents unverified"
  reliability:
    status: CONCERNS
    notes: "Infinite loop risk in TagOpen else branch; malformed input handling not implemented"
  maintainability:
    status: PASS
    notes: "Clean state machine, 8 unit tests, good docs; coverage will improve with Tasks 2-3"
```

## Quality Score

70/100 (3 CONCERNS x 10 = 30 deducted)

NFR assessment: docs/qa/assessments/8.2-nfr-20260128.md
