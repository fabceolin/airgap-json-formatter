# Requirements Traceability Matrix

## Story: 8.6 - XML Tree Model

**Assessment Date:** 2026-01-28
**Reviewer:** Quinn (Test Architect)
**Story Status:** Approved (Not Yet Implemented)

---

## Coverage Summary

| Metric | Count | Percentage |
|--------|-------|------------|
| Total Requirements | 8 | 100% |
| Fully Covered | 0 | 0% |
| Partially Covered | 0 | 0% |
| Not Covered | 8 | 100% |

**Overall Trace Status:** ⚠️ NO IMPLEMENTATION EXISTS

---

## Requirement Mappings

### AC1: QXmlTreeModel class created following QJsonTreeModel pattern

**Coverage: NONE**

**Implementation Status:** Not implemented - `qt/qxmltreemodel.h` and `qt/qxmltreemodel.cpp` do not exist.

**Planned Test Location:** `qt/tests/tst_qxmltreemodel.cpp` (specified in story)

**Required Test Mappings:**

| Test ID | Test Case | Given | When | Then | Priority |
|---------|-----------|-------|------|------|----------|
| 8.6-UNIT-001 | Model inherits QAbstractItemModel | QXmlTreeModel class exists | Inspecting class hierarchy | Class inherits from QAbstractItemModel | P0 |
| 8.6-UNIT-002 | index() returns valid QModelIndex | Model loaded with XML | Calling index(row, col, parent) | Returns valid index for existing items | P0 |
| 8.6-UNIT-003 | parent() returns correct parent index | Model loaded with nested XML | Calling parent() on child index | Returns index of parent element | P0 |
| 8.6-UNIT-004 | rowCount() returns correct count | Model loaded with XML containing 3 children | Calling rowCount() on parent | Returns 3 | P0 |
| 8.6-UNIT-005 | columnCount() returns 1 | Model loaded with any XML | Calling columnCount() | Returns 1 | P1 |
| 8.6-UNIT-006 | data() returns correct role values | Model loaded with XML | Calling data() with KeyRole | Returns tag name | P0 |
| 8.6-UNIT-007 | Required roles defined | Model class inspected | Checking Roles enum | KeyRole, ValueRole, ValueTypeRole, XmlPathRole, ChildCountRole, IsExpandableRole defined | P1 |

---

### AC2: XML elements displayed as expandable nodes

**Coverage: NONE**

**Implementation Status:** Not implemented - QXmlTreeItem class does not exist.

**Required Test Mappings:**

| Test ID | Test Case | Given | When | Then | Priority |
|---------|-----------|-------|------|------|----------|
| 8.6-UNIT-008 | Element node is expandable | `<root><child/></root>` loaded | Querying IsExpandableRole for "root" | Returns true | P0 |
| 8.6-UNIT-009 | Leaf element is not expandable | `<root/>` loaded | Querying IsExpandableRole for "root" (no children) | Returns false | P1 |
| 8.6-UNIT-010 | Nested elements create hierarchy | `<a><b><c/></b></a>` loaded | Navigating tree structure | "a" → "b" → "c" hierarchy correct | P0 |
| 8.6-INT-001 | Tree view expands element nodes | XML model loaded in TreeView.qml | User clicks expand on element | Children become visible | P1 |

---

### AC3: XML attributes displayed as child nodes with `@` prefix

**Coverage: NONE**

**Implementation Status:** Not implemented - attribute handling not built.

**Required Test Mappings:**

| Test ID | Test Case | Given | When | Then | Priority |
|---------|-----------|-------|------|------|----------|
| 8.6-UNIT-011 | Attribute has @ prefix in key | `<a b="1"/>` loaded | Querying KeyRole for attribute | Returns "@b" | P0 |
| 8.6-UNIT-012 | Attribute value accessible | `<a b="1"/>` loaded | Querying ValueRole for attribute | Returns "1" | P0 |
| 8.6-UNIT-013 | Multiple attributes as siblings | `<a x="1" y="2"/>` loaded | Checking children of "a" | Has 2 attribute children "@x" and "@y" | P1 |
| 8.6-UNIT-014 | Attribute ValueType is "attribute" | `<a b="1"/>` loaded | Querying ValueTypeRole | Returns "attribute" | P1 |

---

### AC4: Text content displayed as leaf nodes

**Coverage: NONE**

**Implementation Status:** Not implemented - text content handling not built.

**Required Test Mappings:**

| Test ID | Test Case | Given | When | Then | Priority |
|---------|-----------|-------|------|------|----------|
| 8.6-UNIT-015 | Text content is child of element | `<a>hello</a>` loaded | Checking children of "a" | Has text child with value "hello" | P0 |
| 8.6-UNIT-016 | Text content is leaf | `<a>hello</a>` loaded | Querying IsExpandableRole for text node | Returns false | P1 |
| 8.6-UNIT-017 | CDATA content handled | `<a><![CDATA[data]]></a>` loaded | Checking children of "a" | Has CDATA child with value "data" | P1 |
| 8.6-UNIT-018 | Mixed content parsed | `<a>text1<b/>text2</a>` loaded | Checking children of "a" | Has 3 children: text, element, text | P2 |
| 8.6-UNIT-019 | Whitespace-only text ignored | `<a>   </a>` loaded | Checking children of "a" | Has 0 children (whitespace skipped) | P1 |

---

### AC5: Namespaces and prefixes preserved in display

**Coverage: NONE**

**Implementation Status:** Not implemented - namespace handling not built.

**Required Test Mappings:**

| Test ID | Test Case | Given | When | Then | Priority |
|---------|-----------|-------|------|------|----------|
| 8.6-UNIT-020 | Namespace prefix in key | `<ns:a xmlns:ns="..."/>` loaded | Querying KeyRole | Returns "ns:a" | P0 |
| 8.6-UNIT-021 | NamespacePrefixRole returns prefix | `<ns:a xmlns:ns="..."/>` loaded | Querying NamespacePrefixRole | Returns "ns" | P1 |
| 8.6-UNIT-022 | Default namespace handled | `<a xmlns="..."/>` loaded | Querying model | Element accessible without prefix | P1 |
| 8.6-UNIT-023 | Multiple namespace prefixes | Complex namespaced XML | Navigating tree | Each prefix correctly preserved | P2 |
| 8.6-INT-002 | Namespace displayed in tree view | Namespaced XML in TreeView | Viewing display | "ns:element" format shown | P2 |

---

### AC6: Copy node functionality works (serializes selected node as XML)

**Coverage: NONE**

**Implementation Status:** Not implemented - `serializeNode()` method not built.

**Required Test Mappings:**

| Test ID | Test Case | Given | When | Then | Priority |
|---------|-----------|-------|------|------|----------|
| 8.6-UNIT-024 | serializeNode returns XML string | `<a><b/></a>` loaded | Calling serializeNode on "a" | Returns `<a><b/></a>` | P0 |
| 8.6-UNIT-025 | Serialization includes attributes | `<a b="1"/>` loaded | Calling serializeNode on "a" | Returns `<a b="1"/>` | P0 |
| 8.6-UNIT-026 | Serialization includes text content | `<a>hello</a>` loaded | Calling serializeNode on "a" | Returns `<a>hello</a>` | P1 |
| 8.6-UNIT-027 | Serialization handles nested elements | Deep nested XML | Calling serializeNode on root | Returns complete nested XML | P1 |
| 8.6-INT-003 | Copy to clipboard works | Node selected in tree | User triggers copy | XML string in clipboard | P1 |
| 8.6-E2E-001 | Full copy workflow | XML displayed in tree view | Select node → Copy → Paste | Correct XML in paste target | P2 |

---

### AC7: Tree view switches between JSON and XML model based on format

**Coverage: NONE**

**Implementation Status:** Not implemented - model switching in Main.qml not implemented.

**Required Test Mappings:**

| Test ID | Test Case | Given | When | Then | Priority |
|---------|-----------|-------|------|------|----------|
| 8.6-INT-004 | TreeView accepts JSON model | JSON detected | TreeView.model binding evaluated | JsonBridge.treeModel used | P0 |
| 8.6-INT-005 | TreeView accepts XML model | XML detected | TreeView.model binding evaluated | JsonBridge.xmlTreeModel used | P0 |
| 8.6-INT-006 | Format switch updates model | JSON loaded then XML loaded | Format changes | Model switches from JSON to XML | P1 |
| 8.6-INT-007 | No model race condition | Rapid format changes | Switching JSON↔XML quickly | No crashes, correct final model | P2 |
| 8.6-E2E-002 | User loads XML sees tree | User pastes XML in input | Tree view updates | XML tree structure visible | P1 |

---

### AC8: Performance acceptable for documents up to 10,000 nodes

**Coverage: NONE**

**Implementation Status:** Not implemented - cannot performance test.

**Required Test Mappings:**

| Test ID | Test Case | Given | When | Then | Priority |
|---------|-----------|-------|------|------|----------|
| 8.6-PERF-001 | 1,000 node baseline | Generated 1K node XML | Calling loadXml() | Completes in < 500ms | P0 |
| 8.6-PERF-002 | 10,000 node target | Generated 10K node XML | Calling loadXml() | Completes in < 2000ms | P0 |
| 8.6-PERF-003 | UI remains responsive | 10K node tree loaded | Expanding/collapsing nodes | No visible lag | P1 |
| 8.6-PERF-004 | Memory usage acceptable | 10K node tree loaded | Memory profiled | < 50MB memory increase | P2 |
| 8.6-STRESS-001 | 50,000 node graceful failure | Generated 50K node XML | Calling loadXml() | Rejects with clear error or loads slowly | P3 |

---

## Critical Gaps Summary

| Gap ID | Requirement | Gap Description | Severity | Suggested Action |
|--------|-------------|-----------------|----------|------------------|
| GAP-001 | All ACs | Story not yet implemented - 0% test coverage | CRITICAL | Implement story, then create test file |
| GAP-002 | AC8 | No memory limit guard in implementation plan | HIGH | Add node count guard per risk assessment |
| GAP-003 | Implicit | No malformed XML error handling tests specified | MEDIUM | Add tests for parser error scenarios |
| GAP-004 | Implicit | No test for Comment node type parsing | LOW | Add comment parsing test |

---

## Test File Location

**Planned:** `qt/tests/tst_qxmltreemodel.cpp` (does not exist yet)

**Total Planned Tests:** 32 tests across 8 acceptance criteria

| Test Type | Count | Percentage |
|-----------|-------|------------|
| Unit Tests | 23 | 72% |
| Integration Tests | 7 | 22% |
| E2E Tests | 2 | 6% |
| Performance Tests | 5 | (additional) |

---

## Risk Coverage Mapping

| Risk ID | Risk Description | Test Coverage |
|---------|-----------------|---------------|
| PERF-001 | Memory exhaustion on large XML | 8.6-PERF-002, 8.6-PERF-004, 8.6-STRESS-001 |
| TECH-001 | QXmlStreamReader edge cases | 8.6-UNIT-017, 8.6-UNIT-018, GAP-003 tests |
| TECH-002 | Namespace handling complexity | 8.6-UNIT-020 through 8.6-UNIT-023 |
| OPS-001 | TreeView model switching race | 8.6-INT-007 |

---

## Recommendations

### Immediate Actions

1. **Implement Story 8.6** - No test coverage possible until implementation exists
2. **Create `qt/tests/tst_qxmltreemodel.cpp`** with test structure from Test Design assessment
3. **Add node count guard** per Risk Profile recommendation (50,000 node limit)

### Test Strategy

1. Start with P0 unit tests for core parsing (AC1-AC4)
2. Add P0 performance tests early to catch issues
3. Integration tests after basic unit tests pass
4. E2E tests as final validation

### Coverage Target

- **Minimum:** All P0 tests passing before story marked complete
- **Recommended:** All P0 + P1 tests (85% coverage)
- **Ideal:** All tests including P2/P3 (100% coverage)

---

## Gate Impact

**Current Gate Status:** CANNOT ASSESS - No implementation exists

**Recommended Gate Status After Implementation:**
- PASS: If all P0 tests pass and performance targets met
- CONCERNS: If any P1 gaps remain or performance within 20% of target
- FAIL: If any P0 tests fail or performance > 2x target

---

*Trace matrix: docs/qa/assessments/8.6-trace-20260128.md*
