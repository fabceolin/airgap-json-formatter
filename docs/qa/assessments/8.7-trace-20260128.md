# Requirements Traceability Matrix

## Story: 8.7 - Integration Testing

**Assessment Date:** 2026-01-28
**Reviewer:** Quinn (Test Architect)

---

## Coverage Summary

- **Total Requirements:** 9 Acceptance Criteria + Edge Cases
- **Fully Covered:** 7 (78%)
- **Partially Covered:** 2 (22%)
- **Not Covered:** 0 (0%)

---

## Requirement Mappings

### AC1: Auto-detection correctly identifies JSON vs XML in all tested cases

**Coverage: FULL**

| Test File | Test Case | Given | When | Then |
|-----------|-----------|-------|------|------|
| `tst_format_detection.cpp` | `testDetectJsonObject` | JSON object input `{"a":1}` | detectFormat() called | Returns "json" |
| `tst_format_detection.cpp` | `testDetectJsonArray` | JSON array input `[1,2,3]` | detectFormat() called | Returns "json" |
| `tst_format_detection.cpp` | `testDetectXmlElement` | XML element input `<root/>` | detectFormat() called | Returns "xml" |
| `tst_format_detection.cpp` | `testDetectXmlDeclaration` | XML declaration input | detectFormat() called | Returns "xml" |
| `tst_format_detection.cpp` | `testDetectJsonWithWhitespace` | JSON with leading whitespace | detectFormat() called | Returns "json" |
| `tst_format_detection.cpp` | `testDetectXmlWithWhitespace` | XML with leading whitespace | detectFormat() called | Returns "xml" |
| `tst_format_detection.cpp` | `testReturnMatchesSignal` | Any valid input | detectFormat() called | Return value matches signal value |
| `tst_format_detection.cpp` | `testMultipleDetections` | Multiple format inputs | detectFormat() called sequentially | Correct format detected for each |

**Traceability:** 8 unit tests directly validate AC1. Coverage is comprehensive.

---

### AC2: Format button produces correctly indented XML

**Coverage: FULL**

| Test File | Test Case | Given | When | Then |
|-----------|-----------|-------|------|------|
| `tst_jsonbridge_xml.cpp` | `testFormatXmlUsesAsyncSerialiser` | Valid XML `<root/>` | formatXml() with spaces:4 | Task enqueued, signal emitted |
| `tst_jsonbridge_xml.cpp` | `testFormatXmlSignalStructure` | Valid XML `<root><child/></root>` | formatXml() with spaces:2 | Result contains success and result fields |
| `tst_jsonbridge_xml.cpp` | `testFormatXmlErrorSignalFormat` | Invalid XML `<root` | formatXml() | Error signal with message |

**Test Design References:** Task 3 specifies tests for 2-space, 4-space, and tab indentation (8.7-INT-003 through 8.7-INT-012).

**Gap:** Story tasks list specific indent type tests (2-space, 4-space, tabs) but existing tests only cover spaces:4 and spaces:2. Tab indent test not explicitly implemented yet.

---

### AC3: Minify button produces compact XML

**Coverage: FULL**

| Test File | Test Case | Given | When | Then |
|-----------|-----------|-------|------|------|
| `tst_jsonbridge_xml.cpp` | `testMinifyXmlUsesAsyncSerialiser` | Formatted XML with whitespace | minifyXml() called | Task enqueued, signal emitted |
| `tst_jsonbridge_xml.cpp` | `testMinifyXmlSignalStructure` | XML with spaces `<root>  <child/>  </root>` | minifyXml() called | Result contains success field |

**Traceability:** Integration tests validate minification via bridge layer.

---

### AC4: Syntax highlighting displays correct colors for all XML token types

**Coverage: PARTIAL**

| Test File | Test Case | Given | When | Then |
|-----------|-----------|-------|------|------|
| `tst_jsonbridge_xml.cpp` | `testHighlightXmlReturnsHtml` | XML with attributes | highlightXml() called | Returns non-empty HTML |
| `tst_jsonbridge_xml.cpp` | `testHighlightXmlEmptyInput` | Empty input | highlightXml() called | Returns wrapped HTML |

**Gap Identified:**
- No explicit tests verifying specific color classes for:
  - Tags (blue)
  - Attributes (light blue)
  - Values (orange)
  - Comments (green)
  - CDATA (yellow)
  - Declarations (purple)

**Story Task 4 Reference:** Tests 8.7-INT-014 through 8.7-INT-019 (highlighter color tests) are specified but not yet implemented in existing test files.

---

### AC5: Tree view displays XML structure with expandable nodes

**Coverage: FULL**

| Test File | Test Case | Given | When | Then |
|-----------|-----------|-------|------|------|
| `tst_qxmltreemodel.cpp` | `testSimpleElement` | Simple XML `<root/>` | loadXml() | Root element appears with key="root" |
| `tst_qxmltreemodel.cpp` | `testNestedElements` | Nested XML `<a><b><c/></b></a>` | loadXml() | Nested structure navigable |
| `tst_qxmltreemodel.cpp` | `testSingleAttribute` | XML with attribute | loadXml() | Attribute child with @prefix |
| `tst_qxmltreemodel.cpp` | `testMultipleAttributes` | XML with 3 attributes | loadXml() | 3 attribute children |
| `tst_qxmltreemodel.cpp` | `testTextContent` | XML with text `<a>hello</a>` | loadXml() | Text child with value |
| `tst_qxmltreemodel.cpp` | `testRoleNames` | Model initialized | roleNames() | All roles defined |
| `tst_qxmltreemodel.cpp` | `testDataRoles` | Loaded XML | data() with roles | Correct values returned |
| `tst_qxmltreemodel.cpp` | `testRowCount` | XML with children | rowCount() | Correct count |
| `tst_qxmltreemodel.cpp` | `testIndex` | Loaded XML | index() | Valid indices returned |
| `tst_qxmltreemodel.cpp` | `testParent` | Nested XML | parent() | Correct parent returned |

**Traceability:** 30+ unit tests in `tst_qxmltreemodel.cpp` comprehensively validate tree view model.

---

### AC6: Copy from tree view produces valid XML

**Coverage: FULL**

| Test File | Test Case | Given | When | Then |
|-----------|-----------|-------|------|------|
| `tst_qxmltreemodel.cpp` | `testSerializeSimpleElement` | Loaded XML | serializeNode() on root | Valid XML output |
| `tst_qxmltreemodel.cpp` | `testSerializeWithAttributes` | XML with attributes | serializeNode() | Attributes in output |
| `tst_qxmltreemodel.cpp` | `testSerializeWithChildren` | Nested XML | serializeNode() | Children in output |
| `tst_qxmltreemodel.cpp` | `testSerializeWithText` | XML with text | serializeNode() | Text content preserved |
| `tst_qxmltreemodel.cpp` | `testSerializeWithCData` | XML with CDATA | serializeNode() | CDATA content preserved |

**Traceability:** 5 serialization tests validate copy functionality.

---

### AC7: All JSON functionality continues to work (regression)

**Coverage: FULL**

| Test File | Test Case | Given | When | Then |
|-----------|-----------|-------|------|------|
| `tst_jsonbridge_xml.cpp` | `testJsonFormatStillWorks` | Valid JSON | formatJson() | Success with result |
| `tst_jsonbridge_xml.cpp` | `testJsonMinifyStillWorks` | JSON with whitespace | minifyJson() | Compact result |
| `tst_jsonbridge_xml.cpp` | `testJsonHighlightStillWorks` | Valid JSON | highlightJson() | HTML output |
| `tst_jsonbridge_xml.cpp` | `testJsonValidateStillWorks` | Valid JSON | validateJson() | isValid=true |
| `tst_jsonbridge_xml.cpp` | `testMixedJsonXmlOperations` | JSON and XML | Interleaved operations | All complete successfully |
| `tst_jsonbridge_async.cpp` | `testFormatJsonUsesAsyncSerialiser` | Valid JSON | formatJson() | Async completion |
| `tst_jsonbridge_async.cpp` | `testMinifyJsonUsesAsyncSerialiser` | Valid JSON | minifyJson() | Async completion |
| `tst_jsonbridge_async.cpp` | `testValidateJsonUsesAsyncSerialiser` | Valid JSON | validateJson() | Async completion |

**Traceability:** 8 regression tests explicitly verify JSON functionality unchanged.

---

### AC8: Cross-browser testing passes (Chrome, Firefox, Safari, Edge)

**Coverage: PARTIAL**

| Test Type | Test Location | Given | When | Then |
|-----------|---------------|-------|------|------|
| Manual Script | Story Dev Notes | Local server running | Manual execution | Browser matrix filled |
| Task 7 | Story Tasks | Each browser | Execute manual tests | No failures |

**Gap Identified:**
- No automated cross-browser tests exist
- Relies entirely on manual testing script in story Dev Notes
- No browser test automation framework configured

**Recommendation:** Document browser test results in a separate report file after execution.

---

### AC9: No console errors during normal usage

**Coverage: PARTIAL**

| Test Type | Test Location | Given | When | Then |
|-----------|---------------|-------|------|------|
| Manual Script | Story Dev Notes | DevTools console visible | Normal operations | console.error count = 0 |
| Task 7 | Story Tasks | Each browser | All operations | No errors logged |

**Gap Identified:**
- No automated console error detection
- No QA gate for console error verification
- Manual verification required per story Dev Notes

---

### Edge Cases (Task 8)

**Coverage: FULL**

| Test File | Test Case | Given | When | Then |
|-----------|-----------|-------|------|------|
| `tst_qxmltreemodel.cpp` | `testLoad1000Nodes` | 1000 node XML | loadXml() | Loads in <1000ms |
| `tst_qxmltreemodel.cpp` | `testLoad10000Nodes` | 10000 node XML | loadXml() | Loads in <2000ms |
| `tst_qxmltreemodel.cpp` | `testNodeCountLimit` | 60000 node XML | loadXml() | Error with limit message |
| `tst_qxmltreemodel.cpp` | `testMalformedXml` | Malformed XML | loadXml() | Error signal emitted |
| `tst_qxmltreemodel.cpp` | `testUnclosedTag` | Unclosed tag | loadXml() | lastError() populated |
| `tst_qxmltreemodel.cpp` | `testInvalidCharacter` | Control character | loadXml() | Returns false |
| `tst_format_detection.cpp` | `testPerformanceLargeInput` | 1MB input | detectFormat() | <10ms |
| `tst_format_detection.cpp` | `testMultipleDetections` | Mixed formats | Sequential detection | Correct for each |

---

## Critical Gaps

### 1. Highlighter Color Verification Tests
- **Gap:** No tests verify specific CSS classes for XML token types
- **Risk:** Medium - Colors could regress undetected
- **Recommendation:** Add integration tests that parse highlight HTML output and verify class names

### 2. Cross-Browser Automation
- **Gap:** No automated browser testing framework
- **Risk:** Low - Manual testing adequate for initial release
- **Recommendation:** Consider Playwright or Selenium for CI integration

### 3. Console Error Detection
- **Gap:** No automated console error monitoring
- **Risk:** Low - Covered by manual test script
- **Recommendation:** Add console.error spy in E2E tests if automation added

### 4. Tab Indent Test
- **Gap:** formatXml with tabs not explicitly tested
- **Risk:** Low - Similar code path to spaces
- **Recommendation:** Add `testFormatXmlWithTabs()` test case

---

## Traceability Matrix Summary

| AC | Requirement | Unit Tests | Integration Tests | E2E/Manual | Status |
|----|-------------|------------|-------------------|------------|--------|
| AC1 | Auto-detection JSON/XML | 8 | 2 | 0 | FULL |
| AC2 | Format XML indented | 0 | 3 | 2 | FULL |
| AC3 | Minify XML | 0 | 2 | 2 | FULL |
| AC4 | Syntax highlighting | 0 | 2 | 6 | PARTIAL |
| AC5 | Tree view structure | 10+ | 5 | 2 | FULL |
| AC6 | Copy produces valid XML | 5 | 0 | 2 | FULL |
| AC7 | JSON regression | 4 | 4 | 4 | FULL |
| AC8 | Cross-browser | 0 | 0 | 4 | PARTIAL |
| AC9 | No console errors | 0 | 0 | 4 | PARTIAL |

---

## Test Design Recommendations

### Priority 1 (Must Have Before Sign-off)
1. Execute manual browser testing script and document results
2. Verify syntax highlighting colors visually in each browser

### Priority 2 (Nice to Have)
1. Add `testFormatXmlWithTabs()` to `tst_jsonbridge_xml.cpp`
2. Add highlighter class verification tests
3. Document browser compatibility matrix

### Priority 3 (Future Enhancement)
1. Integrate browser automation (Playwright)
2. Add console.error detection to automated tests

---

## Risk Assessment

| Requirement | Coverage | Risk Level | Notes |
|-------------|----------|------------|-------|
| AC1-AC3 | Full | Low | Core path well tested |
| AC4 | Partial | Medium | Colors need visual verification |
| AC5-AC6 | Full | Low | Comprehensive tree model tests |
| AC7 | Full | Low | Explicit regression tests |
| AC8-AC9 | Partial | Medium | Requires manual execution |

---

## Gate Contribution

**Recommendation:** CONCERNS

- Core functionality (AC1-AC3, AC5-AC7) has full test coverage - PASS contribution
- Highlighting colors (AC4) needs visual verification - CONCERNS
- Cross-browser and console testing (AC8-AC9) needs documented execution - CONCERNS

**Action Required:** Execute manual test script and document browser matrix before release sign-off.
