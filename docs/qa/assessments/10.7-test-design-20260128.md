# Test Design: Story 10.7 — Theme Extension for Markdown

Date: 2026-01-28
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 18
- Unit tests: 10 (56%)
- Integration tests: 5 (28%)
- E2E tests: 3 (17%)
- Priority distribution: P0: 5, P1: 8, P2: 5

## Test Scenarios by Acceptance Criteria

### AC1: Theme.qml extended with Markdown syntax colors

| ID | Level | Priority | Test | Expected Result | Justification |
|----|-------|----------|------|-----------------|---------------|
| 10.7-UNIT-001 | Unit | P0 | All `syntax*` properties exist and return `color` type | Each property returns a valid QML color value | Pure property existence check; foundational for downstream |
| 10.7-UNIT-002 | Unit | P1 | `syntaxHeading` returns distinct values for dark/light | Dark: `#569cd6`, Light: `#0066cc` | Verify ternary logic per-property |
| 10.7-UNIT-003 | Unit | P1 | `syntaxLink` and `syntaxUrl` are visually distinct in each theme | Different hex values in both dark and light modes | Prevents ambiguity between link text and URL |
| 10.7-UNIT-004 | Unit | P2 | `syntaxCodeInlineBg` differs from `syntaxCodeBlockBg` | Distinct background colors for inline vs block code | Usability distinction |

### AC2: Theme.qml extended with preview pane colors

| ID | Level | Priority | Test | Expected Result | Justification |
|----|-------|----------|------|-----------------|---------------|
| 10.7-UNIT-005 | Unit | P0 | All `preview*` properties exist and return `color` type | 10 preview properties all return valid colors | Downstream 10.5 depends on these exact names |
| 10.7-UNIT-006 | Unit | P1 | `previewText` on `previewBackground` has sufficient contrast | Dark: #d4d4d4 on #1e1e1e (>4.5:1), Light: #24292e on #ffffff (>4.5:1) | Primary readability pair |
| 10.7-UNIT-007 | Unit | P2 | `previewHeading` differs from `previewText` | Distinct colors in both themes | Visual hierarchy |

### AC3: Mermaid theme configuration defined

| ID | Level | Priority | Test | Expected Result | Justification |
|----|-------|----------|------|-----------------|---------------|
| 10.7-UNIT-008 | Unit | P1 | `mermaidDarkTheme` is a JS object with `theme` and `themeVariables` keys | Object contains all required Mermaid config keys | Pure data structure validation |
| 10.7-UNIT-009 | Unit | P1 | `mermaidLightTheme` is a JS object with `theme` and `themeVariables` keys | Object contains all required Mermaid config keys | Symmetric with dark theme |
| 10.7-INT-001 | Integration | P1 | `mermaidTheme` property switches between dark/light objects on `darkMode` toggle | Returns dark object when darkMode=true, light when false | Verifies reactive binding |

### AC4: WCAG AA contrast requirements

| ID | Level | Priority | Test | Expected Result | Justification |
|----|-------|----------|------|-----------------|---------------|
| 10.7-UNIT-010 | Unit | P0 | All foreground/background color pairs meet WCAG AA (≥4.5:1 ratio) | Every pair passes; see color pair matrix below | Accessibility compliance — automatable |
| 10.7-INT-002 | Integration | P0 | Contrast check runs as part of build/test pipeline | Script exits 0 when all pairs pass | Prevents regressions in future color changes |

### AC5: Colors documented with usage notes

| ID | Level | Priority | Test | Expected Result | Justification |
|----|-------|----------|------|-----------------|---------------|
| 10.7-INT-003 | Integration | P2 | Theme.qml contains section comments grouping colors by purpose | File contains "Markdown Syntax", "Preview Pane", "Mermaid" section headers | Code review / grep check |

### AC6: Both themes look professional

| ID | Level | Priority | Test | Expected Result | Justification |
|----|-------|----------|------|-----------------|---------------|
| 10.7-E2E-001 | E2E | P1 | Visual review of dark theme with sample Markdown content | All syntax elements visible, distinct, professional appearance | Subjective quality — requires human review |
| 10.7-E2E-002 | E2E | P1 | Visual review of light theme with sample Markdown content | All syntax elements visible, distinct, professional appearance | Cannot be fully automated |

### AC7: Theme toggle updates Markdown views correctly

| ID | Level | Priority | Test | Expected Result | Justification |
|----|-------|----------|------|-----------------|---------------|
| 10.7-INT-004 | Integration | P1 | Toggle darkMode; verify all new properties change value | Every `syntax*`, `preview*`, and `mermaidTheme` property returns different value after toggle | Reactive binding across all new properties |
| 10.7-INT-005 | Integration | P2 | Toggle darkMode rapidly 10 times; no errors | No QML warnings, no undefined values | Stability under rapid toggling |
| 10.7-E2E-003 | E2E | P2 | Toggle theme while Markdown preview is open; UI updates without flicker | Smooth transition, no stale colors visible | User experience quality |

## Risk Coverage

| Risk ID | Mitigating Tests | Notes |
|---------|-----------------|-------|
| BUS-001 (Downstream blocked by wrong colors) | 10.7-UNIT-001, 10.7-UNIT-005 | Property name/type smoke tests catch mismatches early |
| TECH-001 (Naming conflicts) | 10.7-UNIT-001, 10.7-UNIT-005 | Tests verify properties load without errors |
| SEC-001 (WCAG unverified) | 10.7-UNIT-010, 10.7-INT-002 | Automated contrast ratio script |
| OPS-001 (Insufficient docs) | 10.7-INT-003 | Verify section comments exist |

## Color Pair Matrix for WCAG Validation (AC4)

These pairs must all achieve ≥4.5:1 contrast ratio:

| Foreground | Background | Context |
|-----------|-----------|---------|
| syntaxHeading | background (dark/light) | Code view |
| syntaxStrike | background | Code view |
| syntaxLink | background | Code view |
| syntaxUrl | background | Code view |
| syntaxBlockquote | background | Code view |
| syntaxListMarker | background | Code view |
| previewText | previewBackground | Preview pane |
| previewHeading | previewBackground | Preview pane |
| previewLink | previewBackground | Preview pane |
| previewCodeText | previewCodeBg | Code blocks in preview |
| mermaidDarkTheme.primaryTextColor | mermaidDarkTheme.primaryColor | Mermaid nodes |
| mermaidLightTheme.primaryTextColor | mermaidLightTheme.primaryColor | Mermaid nodes |

## Test Data / Environment Requirements

- **Theme.qml** loaded in QML test harness (or script that parses QML property values)
- **Sample Markdown file** containing all syntax elements: h1-h6, bold, italic, strikethrough, links, inline code, code blocks, blockquotes, ordered/unordered lists, mermaid diagram block
- **Contrast ratio calculator** — script using relative luminance formula: `(L1 + 0.05) / (L2 + 0.05)` where L = `0.2126*R + 0.7152*G + 0.0722*B` (sRGB linearized)
- **Browser environment** for E2E visual tests (Chrome/Firefox with WASM support)

## Recommended Execution Order

1. P0 Unit tests — property existence & contrast ratios (fail fast)
2. P0 Integration — contrast pipeline check
3. P1 Unit tests — per-property value checks
4. P1 Integration — toggle reactivity, mermaid switching
5. P1 E2E — visual review both themes
6. P2 tests as time permits

## Gate YAML Block

```yaml
test_design:
  scenarios_total: 18
  by_level:
    unit: 10
    integration: 5
    e2e: 3
  by_priority:
    p0: 5
    p1: 8
    p2: 5
  coverage_gaps: []
```

## Trace References

Test design matrix: `docs/qa/assessments/10.7-test-design-20260128.md`
P0 tests identified: 5
