# Story 8.7: XML Integration Test Plan

## Overview

This document provides the complete test plan for XML integration testing, including automated test coverage, manual browser testing scripts, and the cross-browser compatibility matrix.

## Automated Test Coverage

### Test File: `qt/tests/integration/tst_xml_integration.cpp`

| Test Category | Test Count | Coverage |
|---------------|------------|----------|
| Auto-detection (AC1) | 7 | Complete |
| Format XML (AC2) | 8 | Complete |
| Minify XML (AC3) | 1 | Complete |
| Highlighter (AC4) | 6 | Complete |
| Tree View (AC5) | 4 | Complete |
| Copy Operations (AC6) | 2 | Complete |
| JSON Regression (AC7) | 6 | Complete |
| Edge Cases | 5 | Complete |
| Performance | 1 | Complete |
| **TOTAL** | **40** | **100%** |

### Test Categories Detail

#### 1. Auto-Detection Tests (AC1)
- `testAutoDetection_data()` - Data-driven tests for all formats
- `testAutoDetectJsonObject()` - JSON object detection
- `testAutoDetectJsonArray()` - JSON array detection
- `testAutoDetectXmlElement()` - XML element detection
- `testAutoDetectXmlDeclaration()` - XML declaration detection
- `testAutoDetectWithBom()` - BOM-prefixed content
- `testAutoDetectWithWhitespace()` - Whitespace-prefixed content

#### 2. Format/Minify Tests (AC2, AC3)
- `testFormatXml2SpaceIndent()` - 2-space indentation
- `testFormatXml4SpaceIndent()` - 4-space indentation
- `testFormatXmlWithTabs()` - Tab indentation
- `testMinifyXmlRemovesWhitespace()` - Whitespace removal
- `testFormatPreservesAttributes()` - Attribute preservation
- `testFormatPreservesNamespaces()` - Namespace preservation
- `testFormatPreservesCdata()` - CDATA preservation
- `testFormatPreservesComments()` - Comment preservation

#### 3. Highlighter Tests (AC4)
- `testHighlightTagsBlue()` - Tag highlighting
- `testHighlightAttributesLightBlue()` - Attribute highlighting
- `testHighlightValuesOrange()` - Value highlighting
- `testHighlightCommentsGreen()` - Comment highlighting
- `testHighlightCdataYellow()` - CDATA highlighting
- `testHighlightDeclarationsPurple()` - Declaration highlighting

#### 4. Tree View Tests (AC5, AC6)
- `testTreeElementsExpandable()` - Expandable nodes
- `testTreeAttributesAtPrefix()` - @ prefix for attributes
- `testTreeTextAsLeaf()` - Text as leaf nodes
- `testTreeExpandCollapse()` - Expand/collapse functionality
- `testCopyElementProducesValidXml()` - Element serialization
- `testCopyAttributeProducesValue()` - Attribute value extraction

#### 5. JSON Regression Tests (AC7)
- `testJsonFormatStillWorks()` - JSON formatting
- `testJsonMinifyStillWorks()` - JSON minification
- `testJsonHighlightStillWorks()` - JSON highlighting
- `testJsonTreeViewStillWorks()` - JSON tree view
- `testJsonValidationStillWorks()` - JSON validation
- `testHistorySaveLoadStillWorks()` - History operations

#### 6. Edge Case Tests
- `testLargeXml1MB()` - 1MB XML handling
- `testDeeplyNestedXml100Levels()` - 100-level nesting
- `testXmlWithManyAttributes()` - 100+ attributes
- `testInvalidXmlShowsError()` - Error handling
- `testMixedJsonXmlWorkflow()` - Format switching

#### 7. Performance Tests
- `testFormat1MBPerformance()` - 1MB format < 150ms (WASM)

## Manual Browser Testing Script

### Prerequisites
1. Build latest WASM: `wasm-pack build`
2. Build Qt WASM: `qt-wasm-build`
3. Deploy to local server: `python -m http.server 8080`
4. Open each browser to http://localhost:8080

### Test Execution Checklist

#### Auto-Detection Tests
| ID | Test | Chrome | Firefox | Safari | Edge |
|----|------|--------|---------|--------|------|
| M-001 | Paste `{"a":1}` -> Format selector shows "JSON (auto)" | [ ] | [ ] | [ ] | [ ] |
| M-002 | Paste `<root/>` -> Format selector shows "XML (auto)" | [ ] | [ ] | [ ] | [ ] |
| M-003 | Clear input -> Format selector shows "Auto" | [ ] | [ ] | [ ] | [ ] |

#### Format Tests
| ID | Test | Chrome | Firefox | Safari | Edge |
|----|------|--------|---------|--------|------|
| M-004 | Paste minified XML -> Click Format -> Properly indented | [ ] | [ ] | [ ] | [ ] |
| M-005 | Change indent to "2 spaces" -> Click Format -> 2-space indent | [ ] | [ ] | [ ] | [ ] |
| M-006 | Change indent to "Tab" -> Click Format -> Tab indent | [ ] | [ ] | [ ] | [ ] |
| M-007 | Click Minify -> All whitespace removed | [ ] | [ ] | [ ] | [ ] |

#### Highlight Tests
| ID | Test | Chrome | Firefox | Safari | Edge |
|----|------|--------|---------|--------|------|
| M-008 | Switch to Code view | [ ] | [ ] | [ ] | [ ] |
| M-009 | Verify tags are blue | [ ] | [ ] | [ ] | [ ] |
| M-010 | Verify attributes are light blue | [ ] | [ ] | [ ] | [ ] |
| M-011 | Verify values are orange | [ ] | [ ] | [ ] | [ ] |
| M-012 | Verify comments are green | [ ] | [ ] | [ ] | [ ] |

#### Tree View Tests
| ID | Test | Chrome | Firefox | Safari | Edge |
|----|------|--------|---------|--------|------|
| M-013 | Switch to Tree view | [ ] | [ ] | [ ] | [ ] |
| M-014 | Verify elements are expandable | [ ] | [ ] | [ ] | [ ] |
| M-015 | Verify attributes show @prefix | [ ] | [ ] | [ ] | [ ] |
| M-016 | Right-click -> Copy works | [ ] | [ ] | [ ] | [ ] |

#### JSON Regression Tests
| ID | Test | Chrome | Firefox | Safari | Edge |
|----|------|--------|---------|--------|------|
| M-017 | Paste JSON -> Format works | [ ] | [ ] | [ ] | [ ] |
| M-018 | Paste JSON -> Minify works | [ ] | [ ] | [ ] | [ ] |
| M-019 | Paste JSON -> Tree view works | [ ] | [ ] | [ ] | [ ] |
| M-020 | Save to history -> Load from history works | [ ] | [ ] | [ ] | [ ] |

#### Console Error Check
| ID | Test | Chrome | Firefox | Safari | Edge |
|----|------|--------|---------|--------|------|
| M-021 | Complete all above tests with DevTools open | [ ] | [ ] | [ ] | [ ] |
| M-022 | Verify console.error count = 0 | [ ] | [ ] | [ ] | [ ] |

## Browser Compatibility Matrix

### Required Browsers (Must Pass)
| Browser | Version | Priority | Status |
|---------|---------|----------|--------|
| Chrome | Latest | P0 | Pending |
| Firefox | Latest | P0 | Pending |
| Edge | Latest | P1 | Pending |

### Optional Browsers (Best Effort)
| Browser | Version | Priority | Status |
|---------|---------|----------|--------|
| Safari | Latest | P2 | Pending |

### Known Browser-Specific Issues
| Issue ID | Browser | Description | Workaround |
|----------|---------|-------------|------------|
| - | - | None identified | - |

## Test Data

### Simple XML
```xml
<?xml version="1.0" encoding="UTF-8"?>
<root>
    <item id="1">First</item>
    <item id="2">Second</item>
</root>
```

### Complex XML (namespaces, CDATA, comments)
```xml
<?xml version="1.0"?>
<ns:root xmlns:ns="http://example.com">
    <!-- Configuration section -->
    <ns:config enabled="true">
        <![CDATA[
            Special <characters> & "quotes"
        ]]>
    </ns:config>
</ns:root>
```

### Regression JSON
```json
{
    "name": "Test",
    "items": [1, 2, 3],
    "nested": {
        "key": "value"
    }
}
```

## Execution Instructions

### Running Automated Tests
```bash
cd qt/build
cmake .. && make
./tests/tst_xml_integration
```

### Expected Output
```
PASS   : tst_XmlIntegration::initTestCase()
PASS   : tst_XmlIntegration::testAutoDetection(json-object)
PASS   : tst_XmlIntegration::testAutoDetection(json-array)
PASS   : tst_XmlIntegration::testAutoDetection(xml-element)
...
Totals: 40 passed, 0 failed, 0 skipped
```

### Running Manual Tests
1. Follow the Manual Browser Testing Script above
2. Record results in the checkboxes
3. Document any failures or issues
4. Update the Browser Compatibility Matrix

## Sign-Off Requirements

### Automated Tests
- [ ] All 40 integration tests pass
- [ ] No regressions in existing test suites

### Manual Browser Tests
- [ ] Chrome: All tests pass, no console errors
- [ ] Firefox: All tests pass, no console errors
- [ ] Edge: All tests pass, no console errors
- [ ] Safari: All tests pass, no console errors (optional)

### Performance Verification
- [ ] 1MB XML formats in < 150ms (WASM build)

### Sign-Off
| Role | Name | Date | Signature |
|------|------|------|-----------|
| QA Lead | | | |
| Dev Lead | | | |
| Product Owner | | | |

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-28 | 1.0 | Initial test plan created | Dev Agent |
